<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>YarnSpinner: ANTLR/antlr-notes-and-discussion.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="YarnSpinnerLogo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">YarnSpinner
   </div>
   <div id="projectbrief">YarnSpinner is an interpreter for the Yarn language, written in C#.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00193.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ANTLR/antlr-notes-and-discussion.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="a00193.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor"># Lets talk about the WIP ANTLR YarnSpinner parser</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;So <span class="keyword">this</span> is a WIP parser/lexer <span class="keywordflow">for</span> YarnSpinner written in ANTLR with that plan being that it will eventually replace the hand made one currently in use.</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;**THIS IS ALL STILL WORK IN PROGRESS AND OPEN TO CHANGE**</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;For discussion on <span class="keyword">this</span> jump into the #yarnspinner channel on the [Narrative Game Development](https:<span class="comment">//narrativegamedev.slack.com/) slack.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;I thought it might be worth documenting what <span class="keyword">this</span> WIP version does/doesn<span class="stringliteral">&#39;t do and why it is that way, should make moving forward a bit simpler.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral">Additionally because we are doing this I think it is a good time to open up discussion about the syntax design of YarnSpinner.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">I am of the opinion that the syntax should be changed as it currently grew organically rather than by design.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">That doesn&#39;</span>t mean what it currently is is garbage or that is worth throwing out the design already done as there is a LOT of great stuff in there.</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;This is also NOT me saying how it should be done, <span class="keyword">this</span> is just how I am doing it and ideally forms the beginning of a discussion around the future of YarnSpinner syntax and features.</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;## <span class="keyword">using</span> the ANTRL compiler</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;This is now partially built into YarnSpinner. `Dialogue` objects have an `experimentalMode` <span class="keywordtype">bool</span> flag that <span class="keywordflow">if</span> set to <span class="keyword">true</span>, they will use the ANTLR compiler.</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;This can only be done on objects <span class="keyword">using</span> the yarn.txt format, all others will fail to parse.</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;To use <span class="keyword">this</span> you will need to install ANTLR on your system and run it across the grammar files.</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;At <span class="keyword">this</span> point in time the <a class="code" href="a00336.html#a3da6d48778c7b08a040bf24377f67792">output</a> of ANTLR is not stored in source control (and probably never should be).</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;Assuming you have an alias <span class="keywordflow">for</span> antlr already set up, to generate the files you will need the command is as follows:</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;```</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;antlr -Dlanguage=CSharp -visitor *.g4</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;```</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;Then copy these into the YarnSpinner project.</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;## `=` is <span class="keywordflow">for</span> assignment and assignment alone</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;In a language that doesn<span class="stringliteral">&#39;t have operator overloading, and pretty much always defines a new keyword for new functionality, we have this single case where `=` can be used for comparison and equality.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">This is a peeve of mine because it complicates design and implementation for, what is in my mind, a tiny feature, so I just took that feature out.</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">### Reasons to keep old style</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="stringliteral">- Backwards compatibility</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral">- Initially makes more sense than `==` (subjective)</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="stringliteral">### Reasons to change</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral">- easy enough to explain to people where to use `==` vs. `=`</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral">- limit confusion for users if they see dialogue using `==` and `=`</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="stringliteral">- avoid arguments around &quot;well we already have overloading on =&quot; for future syntax</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral">- closer to existing programming languages</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral">- already have `is` keyword if people really don&#39;</span>t like `==`</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">## The `-&gt;`  shortcut syntax</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;Shortcuts are now implemented <span class="keyword">using</span> a two stage approach, where the Yarn files are run through a preprocessor (the reference preprocesser and one used <span class="keywordflow">for</span> tests is currently written in Python, the one inside the project is written in C#) to add in <a class="code" href="a00336.html#a00fba9ee9674b2513dbe28eab795b734">indents</a> and dedents to build up the blocks <span class="keywordflow">for</span> shortcuts.</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;Due to the nature of ANTLR and YarnSpinners rather unusual approach to whitespace <span class="keyword">this</span> was found to be the simplest approach as it means there is no code in the grammar file itself.</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;There is now however an extra step and the preprocessor will need to be ported to each language.</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;It was done <span class="keyword">this</span> way as the preprocessor itself is quite straightforward compared to what the extra code in the grammar would be.</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;A side-effect of <span class="keyword">this</span> is that a symbol had to be chosen to represent the <a class="code" href="a00336.html#a00fba9ee9674b2513dbe28eab795b734">indents</a>/dedents.</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;I went with the `\a` or bell <span class="keywordflow">for</span> <a class="code" href="a00336.html#a00fba9ee9674b2513dbe28eab795b734">indents</a> (playing the role `{` normally does) and `\v` or vertical tab <span class="keywordflow">for</span> dedent (`}` equivalent).</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;Both of these were chosen as they are invisible (somewhat) and unlikely (especially in the case of bell) to be used in existing Yarn files, additionally as control characters they don&#39;t limit the amount of available characters in text lines.</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;This does mean however if someone was using either of those two in their Yarn files their files won&#39;t parse correctly.</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;While this works this also allows for an opportunity to discuss the `-&gt;` syntax.</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;It currently has remarkably flexible rules around the whitespace, such that it allows structures that would break in almost any other whitespace programming language.</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;Is this something worth changing?</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;Options to change include:</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;- Locking down the syntax a bit more so that whitespace rules are enforced more than currently, Python offers a guideline for how this would look.</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;- Using the use of a `{ }` (or something similar) syntax <span class="keywordflow">for</span> the `-&gt;` code blocks.</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;- Using a close tag similar to `&lt;&lt;endif&gt;&gt;` perhaps `&lt;-`.</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;At <span class="keyword">this</span> stage it isn<span class="stringliteral">&#39;t worth changing as it is currently working fine, but this is something to consider going forward.</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="stringliteral">It might well be worth changing the ident and dedent characters to ^] and ^^ (Group Separator and Record Separator) as these are *more* invisible than bell and vertical tab and semantically make more sense and are in even less use than bell or vertical tab.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="stringliteral">### Reasons to keep to old style</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">- Backwards compatibility</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">- More obvious (subjective)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral">- easier to write</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">### Reasons to change to new style</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">- Easier to parse</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral">- Allows for single line shortcuts eg -&gt;etc {-&gt;etcetc}</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">## Comments can&#39;</span>t go <span class="keyword">inline</span> a command</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;For example the following doesn<span class="stringliteral">&#39;t work</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="stringliteral">```</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="stringliteral">&lt;&lt;set $foo = 2 + 1 *</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="stringliteral">    (2 + 1) // quick explanation why you would do this, seriously explain this, this seems weird to break this statement up...</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="stringliteral">&gt;&gt;</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="stringliteral">```</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="stringliteral">Purely an implementation issue, I see literally no reason this shouldn&#39;</span>t happen, just saying that it is that <span class="keywordflow">case</span> <span class="keywordflow">for</span> now.</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;## Option parsing is far from ideal</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;Because the structure of the option syntax is `[[free text | nodeName]]`, when creating single structure option `[[nodeName]]` <span class="keyword">this</span> is not being correctly identified as an option link but instead as an option text.</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;This isn<span class="stringliteral">&#39;t really a huge issue and it doesn&#39;</span>t impact the implementation of the ANTLR compiler, it just looks messy to me.</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;Options are to change the syntax.</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;My suggestion to change the syntax so that it goes `[[nodeName | free text]]`, <span class="keyword">this</span> makes it easier to parse.</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;This also makes more semantic sense to me as the link to the node is more important than the dialogue line that triggers it.</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;### Reasons to keep to the old style</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;- backwards compatibility</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;### Reasons to change to the <span class="keyword">new</span> style</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;- easier to parse</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;- makes more sense start with the link (subjective)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">## Keywords are allowed to be upper or lower case</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;Keywords like `<span class="keywordflow">else</span>`, `endif`, `is`, etc etc are allowed in either all upper (eg `SET`) or all lower (eg `set`) <span class="keywordflow">case</span>.</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;This is something I did quickly as it took almost zero effort to <span class="keywordflow">do</span> and personally makes sense.</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;The question is, is it worth keeping <span class="keyword">this</span>, picking a single <span class="keywordflow">case</span> approach, extending it to allowed mixed <span class="keywordflow">case</span> (eg `eNDiF`), extending to allow Titled <span class="keywordflow">case</span> (eg `True`, `<span class="keyword">true</span>`, `TRUE` all being valid but `tRue` not valid)?</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">## functions vs actions vs commands</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;As it currently stands YarnSpinner has three different ways of controlling the game and dialogue.</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;Commands use a keyword (like `<span class="keywordflow">if</span>` or `set`) and are followed by an expression:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;`&lt;&lt;<span class="keywordflow">if</span> expression&gt;&gt;`</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;Actions allow <span class="keywordflow">for</span> the dialogue to send a message back to the game and don<span class="stringliteral">&#39;t use keywords and are allowed most text:</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral">`&lt;&lt;unlockAchievement doAThing&gt;&gt;`</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="stringliteral">Functions don&#39;</span>t use keywords and <span class="keywordflow">return</span> as an expression and can influence both the game and the dialogue (depending how used):</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;`&lt;&lt;assert(1 &lt; 3)&gt;&gt;`</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;This is not only messy in my mind from a readability perspective it also makes it trickier to parse.</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;We have 3 uses of the `&lt;&lt;&gt;&gt;` syntax, one of which has keywords to control and two which are determined entirely on the text inside.</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;The commands impact the dialogue, functions impact YarnSpinner itself, and actions impact the game.</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;In my mind these are completely unrelated to each other in functionality yet share a very common syntax, leading to confusion or small typos resulting in unexpected behaviour, eg:</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;- should `&lt;&lt;if 5&gt;&gt;` be a command or an action?</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;- is `&lt;&lt;hello there()&gt;&gt;` a function or an action?</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;- how is `&lt;&lt;assert(2 &lt; 3)&gt;&gt;` different from `&lt;&lt;assert 2 &lt; 3&gt;&gt;`?</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;These are easily answered and understandable from my perspective but I believe the point should be to minimise the amount of specialised knowledge needed, and overloading syntax is the opposite of that.</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;While these can be fixed with warning and error messages it does feel a bit like something that should be investigated if this is the right way moving forward.</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;I would change this either so everything has a keyword to control its functionality, or change the `&lt;&lt;&gt;&gt;` so that the different capabilities use different syntax.</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;## Identifiers</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;The rules around what can be identifiers are effectively arbitrary, as it currently stands they can be any upper or lower a-z, any numbers, and the _ symbol.</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;This also somewhat ties into almost everything else that can have generic text, i.e do we allow arbitrary text inside actions or does it have to conform to a pattern?</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;What should and shouldn<span class="stringliteral">&#39;t be allowed as identifiers and why?</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">## Headers</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">As it currently stands the allowed headers are `title` (required) and `tags`, `position`, and `colorID` all being optional.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">Because of a combination of my hesitance to in line code, and ANTLR4 syntax there is nothing stopping you putting as many of the optional headers in as you want.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">When it comes time to compile the Yarn files the compiler will complain about this but the parser will not.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">This is another area that needs to be discussed, not everything can be done in ANTLR, in places where it can be solved with in lining code we need to work out some rules for when we should and should not do this.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">As it currently stands there are no code sections in the the grammar.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="stringliteral">This is partially due to my experience with ANTLR and partially due to my unwillingness to add code, as each part of code is something that will have to be ported when the time comes, this feels messy and against the spirit of ANTLR to me.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="stringliteral">With that said, some things will be MUCH easier to do with in line code and can likely be written in a way that is either applicable to multiple target languages or simple enough that tweaking it won&#39;</span>t be a problem, this is all an area we need to look at as we head forward.</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;This also opens up the question of what are allowed in headers.</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;- What headers should be mandatory?</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;- Can you define your own headers?</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;- What value can each header support?</div>
<div class="ttc" id="a00336_html_a3da6d48778c7b08a040bf24377f67792"><div class="ttname"><a href="a00336.html#a3da6d48778c7b08a040bf24377f67792">preprocessor.output</a></div><div class="ttdeci">tuple output</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00092">preprocessor.py:92</a></div></div>
<div class="ttc" id="a00336_html_a00fba9ee9674b2513dbe28eab795b734"><div class="ttname"><a href="a00336.html#a00fba9ee9674b2513dbe28eab795b734">preprocessor.indents</a></div><div class="ttdeci">list indents</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00020">preprocessor.py:20</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00193.html">antlr-notes-and-discussion.md</a></li>
    <li class="footer">Generated on Mon Jul 31 2017 05:22:00 for YarnSpinner by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
