\hypertarget{a00159}{\section{Yarn.\-Table\-Generator Class Reference}
\label{a00159}\index{Yarn.\-Table\-Generator@{Yarn.\-Table\-Generator}}
}


Collaboration diagram for Yarn.\-Table\-Generator\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=186pt]{a00745}
\end{center}
\end{figure}
\subsection*{Static Package Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{a00159_a1d65ef643c3f3495cf9480f86172ff87}{Generate\-Tables} (\hyperlink{a00097}{Generate\-Table\-Options} options)
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
string \hyperlink{a00159_a72dd508110f2d6ec21a8fa7d3cf35291}{Create\-C\-S\-V\-Row} (params string\mbox{[}$\,$\mbox{]} entries)
\item 
string \hyperlink{a00159_a1014b76df01db6b9e7936e6ab6d44fb6}{Create\-C\-S\-V\-Row} (Key\-Value\-Pair$<$ string, string $>$ entry)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 8 of file Table\-Generator.\-cs.



\subsection{Member Function Documentation}
\hypertarget{a00159_a72dd508110f2d6ec21a8fa7d3cf35291}{\index{Yarn\-::\-Table\-Generator@{Yarn\-::\-Table\-Generator}!Create\-C\-S\-V\-Row@{Create\-C\-S\-V\-Row}}
\index{Create\-C\-S\-V\-Row@{Create\-C\-S\-V\-Row}!Yarn::TableGenerator@{Yarn\-::\-Table\-Generator}}
\subsubsection[{Create\-C\-S\-V\-Row}]{\setlength{\rightskip}{0pt plus 5cm}string Yarn.\-Table\-Generator.\-Create\-C\-S\-V\-Row (
\begin{DoxyParamCaption}
\item[{params string\mbox{[}$\,$\mbox{]}}]{entries}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00159_a72dd508110f2d6ec21a8fa7d3cf35291}


Definition at line 124 of file Table\-Generator.\-cs.



Referenced by Yarn.\-Table\-Generator.\-Create\-C\-S\-V\-Row().


\begin{DoxyCode}
124                                                       \{
125             \textcolor{keywordflow}{return} string.Join (\textcolor{stringliteral}{","}, entries);
126         \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00159_a72dd508110f2d6ec21a8fa7d3cf35291_icgraph}
\end{center}
\end{figure}


\hypertarget{a00159_a1014b76df01db6b9e7936e6ab6d44fb6}{\index{Yarn\-::\-Table\-Generator@{Yarn\-::\-Table\-Generator}!Create\-C\-S\-V\-Row@{Create\-C\-S\-V\-Row}}
\index{Create\-C\-S\-V\-Row@{Create\-C\-S\-V\-Row}!Yarn::TableGenerator@{Yarn\-::\-Table\-Generator}}
\subsubsection[{Create\-C\-S\-V\-Row}]{\setlength{\rightskip}{0pt plus 5cm}string Yarn.\-Table\-Generator.\-Create\-C\-S\-V\-Row (
\begin{DoxyParamCaption}
\item[{Key\-Value\-Pair$<$ string, string $>$}]{entry}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00159_a1014b76df01db6b9e7936e6ab6d44fb6}


Definition at line 128 of file Table\-Generator.\-cs.



References Yarn.\-Table\-Generator.\-Create\-C\-S\-V\-Row().


\begin{DoxyCode}
128                                                                 \{
129             \textcolor{keywordflow}{return} \hyperlink{a00159_a72dd508110f2d6ec21a8fa7d3cf35291}{CreateCSVRow} (\textcolor{keyword}{new} \textcolor{keywordtype}{string}[] \{ entry.Key, entry.Value \});
130         \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00159_a1014b76df01db6b9e7936e6ab6d44fb6_cgraph}
\end{center}
\end{figure}


\hypertarget{a00159_a1d65ef643c3f3495cf9480f86172ff87}{\index{Yarn\-::\-Table\-Generator@{Yarn\-::\-Table\-Generator}!Generate\-Tables@{Generate\-Tables}}
\index{Generate\-Tables@{Generate\-Tables}!Yarn::TableGenerator@{Yarn\-::\-Table\-Generator}}
\subsubsection[{Generate\-Tables}]{\setlength{\rightskip}{0pt plus 5cm}static int Yarn.\-Table\-Generator.\-Generate\-Tables (
\begin{DoxyParamCaption}
\item[{{\bf Generate\-Table\-Options}}]{options}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [package]}}}\label{a00159_a1d65ef643c3f3495cf9480f86172ff87}


Definition at line 10 of file Table\-Generator.\-cs.



References Yarn.\-Yarn\-Spinner\-Console.\-A\-L\-L\-O\-W\-E\-D\-\_\-\-E\-X\-T\-E\-N\-S\-I\-O\-N\-S, Yarn.\-Generate\-Table\-Options.\-only\-Use\-Tag, and Yarn.\-Base\-Options.\-verbose.



Referenced by Yarn.\-Yarn\-Spinner\-Console.\-Main().


\begin{DoxyCode}
11         \{
12 
13             YarnSpinnerConsole.CheckFileList(options.files, 
      \hyperlink{a00185_a0979de7ea02c8c0375b8220a12e6575e}{YarnSpinnerConsole.ALLOWED\_EXTENSIONS});
14 
15             \textcolor{keywordflow}{if} (options.\hyperlink{a00031_ada4d83d1756918f362d55f6649b82b17}{verbose} && options.\hyperlink{a00097_a8b30c1b7fb1b74eae455a568c1024b3d}{onlyUseTag} != null) \{
16                 YarnSpinnerConsole.Note(string.Format(\textcolor{stringliteral}{"Only using lines from nodes tagged \(\backslash\)"\{0\}\(\backslash\)""}, 
      options.onlyUseTag));
17             \}
18 
19             \textcolor{keywordtype}{bool} linesWereUntagged = \textcolor{keyword}{false};
20 
21             \textcolor{keywordflow}{foreach} (var file \textcolor{keywordflow}{in} options.\hyperlink{a00031_aa93cbb1bc1d5328e0a417012621e92d2}{files}) \{
22 
23                 var dialogue = YarnSpinnerConsole.CreateDialogueForUtilities();
24 
25                 dialogue.LoadFile (file);
26 
27                 var stringTable = dialogue.GetStringTable ();
28 
29                 var emittedStringTable = \textcolor{keyword}{new} Dictionary<string,string> ();
30 
31                 var anyLinesAreUntagged = \textcolor{keyword}{false};
32 
33                 \textcolor{keywordflow}{foreach} (var entry \textcolor{keywordflow}{in} stringTable) \{
34 
35                     \textcolor{comment}{// If options.onlyUseTag is set, we skip all lines in nodes that}
36                     \textcolor{comment}{// don't have that tag.}
37                     \textcolor{keywordflow}{if} (options.\hyperlink{a00097_a8b30c1b7fb1b74eae455a568c1024b3d}{onlyUseTag} != null) \{
38 
39                         \textcolor{comment}{// Find the tags for the node that this string is in}
40                         \hyperlink{a00121}{LineInfo} stringInfo;
41 
42                         \textcolor{keywordflow}{try} \{
43                             stringInfo = dialogue.program.lineInfo[entry.Key];
44                         \} \textcolor{keywordflow}{catch} (KeyNotFoundException) \{
45                             YarnSpinnerConsole.Error(string.Format(\textcolor{stringliteral}{"\{0\}: lineInfo table does not contain an
       entry for line \{1\} (\(\backslash\)"\{2\}\(\backslash\)")"}, file, entry.Key, entry.Value));
46                             \textcolor{keywordflow}{return} 1;
47                         \}
48 
49                         \hyperlink{a00041_a00361}{Node} node;
50 
51                         \textcolor{keywordflow}{try} \{
52                             node = dialogue.program.nodes[stringInfo.nodeName];
53                         \} \textcolor{keywordflow}{catch} (KeyNotFoundException) \{
54                             YarnSpinnerConsole.Error(string.Format(\textcolor{stringliteral}{"\{0\}: Line \{1\}'s lineInfo claims that
       the line originates in node \{2\}, but this node is not present in this program."}, file, entry.Key, 
      stringInfo.nodeName));
55                             \textcolor{keywordflow}{return} 1;
56                         \}
57 
58 
59                         var tags = node.tags;
60 
61                         \textcolor{comment}{// If the tags don't include the one we're looking for,}
62                         \textcolor{comment}{// skip this line}
63                         \textcolor{keywordflow}{if} (tags.FindIndex(i => i == options.\hyperlink{a00097_a8b30c1b7fb1b74eae455a568c1024b3d}{onlyUseTag}) == -1) \{
64                             \textcolor{keywordflow}{continue};
65                         \}
66 
67                     \}
68 
69                     \textcolor{keywordflow}{if} (entry.Key.StartsWith(\textcolor{stringliteral}{"line:"}) == \textcolor{keyword}{false}) \{
70                         anyLinesAreUntagged = \textcolor{keyword}{true};
71                     \} \textcolor{keywordflow}{else} \{
72                         emittedStringTable [entry.Key] = entry.Value;
73                     \}
74                 \}
75 
76                 \textcolor{keywordflow}{if} (anyLinesAreUntagged) \{
77                     YarnSpinnerConsole.Warn(string.Format(\textcolor{stringliteral}{"Untagged lines in \{0\}"}, file));
78                     linesWereUntagged = \textcolor{keyword}{true};
79                 \}
80 
81                 \textcolor{comment}{// Generate the CSV}
82 
83                 \textcolor{keyword}{using} (var w = \textcolor{keyword}{new} System.IO.StringWriter()) \{
84                     \textcolor{keyword}{using} (var csv = \textcolor{keyword}{new} \hyperlink{a00071}{CsvWriter}(w)) \{
85 
86                         csv.WriteHeader<\hyperlink{a00124}{LocalisedLine}>();
87 
88                         \textcolor{keywordflow}{foreach} (var entry \textcolor{keywordflow}{in} emittedStringTable)
89                         \{
90 
91                             var l = \textcolor{keyword}{new} \hyperlink{a00124}{LocalisedLine}();
92                             l.LineCode = entry.Key;
93                             l.LineText = entry.Value;
94                             l.Comment = \textcolor{stringliteral}{""};
95 
96                             csv.WriteRecord(l);
97                         \}
98 
99                         var dir = System.IO.Path.GetDirectoryName(file);
100                         var fileName = System.IO.Path.GetFileNameWithoutExtension(file);
101                         fileName += \textcolor{stringliteral}{"\_lines.csv"};
102                         var filePath = System.IO.Path.Combine(dir, fileName);
103 
104                         System.IO.File.WriteAllText(filePath, w.ToString());
105 
106                         \textcolor{keywordflow}{if} (options.\hyperlink{a00031_ada4d83d1756918f362d55f6649b82b17}{verbose})
107                         \{
108                             YarnSpinnerConsole.Note(\textcolor{stringliteral}{"Wrote "} + filePath);
109                         \}
110                     \}
111                 \}
112 
113             \}
114 
115             \textcolor{keywordflow}{if} (linesWereUntagged) \{
116                 YarnSpinnerConsole.Warn(\textcolor{stringliteral}{"Some lines were not tagged, so they weren't added to the "} +
117                                \textcolor{stringliteral}{"string file. Use this tool's 'generate' action to add them."});
118             \}
119 
120             \textcolor{keywordflow}{return} 0;
121 
122         \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00159_a1d65ef643c3f3495cf9480f86172ff87_icgraph}
\end{center}
\end{figure}




The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
Yarn\-Spinner\-Console/\hyperlink{a00309}{Table\-Generator.\-cs}\end{DoxyCompactItemize}
