\hypertarget{a00154}{\section{Yarn.\-Program Class Reference}
\label{a00154}\index{Yarn.\-Program@{Yarn.\-Program}}
}


Collaboration diagram for Yarn.\-Program\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=186pt]{a00720}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{a00154_a977d1ed02e3f6f39d30dfea1663e7927}{Load\-Strings} (Dictionary$<$ string, string $>$ new\-Strings)
\begin{DoxyCompactList}\small\item\em Loads a new string table into the program. \end{DoxyCompactList}\item 
string \hyperlink{a00154_a9baf491479375aa8c3aa2b0c31cf0932}{Register\-String} (string the\-String, string node\-Name, string line\-I\-D, int line\-Number, bool localisable)
\item 
string \hyperlink{a00154_a14737b93594c4aab25c59cb0a3c918f7}{Get\-String} (string key)
\item 
string \hyperlink{a00154_a2f5bb468ce53eb7bbe647e3c11ddbb61}{Dump\-Code} (\hyperlink{a00131}{Library} l)
\item 
string \hyperlink{a00154_aad8029f37832ff1985fad6a31e51afd8}{Get\-Text\-For\-Node} (string node\-Name)
\item 
I\-Enumerable$<$ string $>$ \hyperlink{a00154_a116312a32b20bc18e09f90c9c92a079f}{Get\-Tags\-For\-Node} (string node\-Name)
\item 
void \hyperlink{a00154_afd3385ca1f7589b3b9dae3646e4fee84}{Include} (\hyperlink{a00154}{Program} other\-Program)
\end{DoxyCompactItemize}
\subsection*{Package Attributes}
\begin{DoxyCompactItemize}
\item 
Dictionary$<$ string, string $>$ \hyperlink{a00154_a59263e00cecfe36d9881b4c30b048f09}{strings} = new Dictionary$<$string, string$>$()
\item 
Dictionary$<$ string, \hyperlink{a00133}{Line\-Info} $>$ \hyperlink{a00154_a0d4da395947767b4a1eaaff8a9842adc}{line\-Info} = new Dictionary$<$string, \hyperlink{a00133}{Line\-Info}$>$()
\item 
Dictionary$<$ string, \hyperlink{a00053_a00382}{Node} $>$ \hyperlink{a00154_a3f4928a577c88263ad016be259b175c4}{nodes} = new Dictionary$<$string, \hyperlink{a00053_a00382}{Node}$>$()
\end{DoxyCompactItemize}
\subsection*{Properties}
\begin{DoxyCompactItemize}
\item 
Dictionary$<$ string, string $>$ \hyperlink{a00154_aa8fedbfceaf931d1da3f600eaab6ae87}{untagged\-Strings}\hspace{0.3cm}{\ttfamily  \mbox{[}get\mbox{]}}
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{a00154_a8ef1d10094ef00311aade6715ba78ec7}{string\-Count} = 0
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 84 of file Program.\-cs.



\subsection{Member Function Documentation}
\hypertarget{a00154_a2f5bb468ce53eb7bbe647e3c11ddbb61}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!Dump\-Code@{Dump\-Code}}
\index{Dump\-Code@{Dump\-Code}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{Dump\-Code}]{\setlength{\rightskip}{0pt plus 5cm}string Yarn.\-Program.\-Dump\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Library}}]{l}
\end{DoxyParamCaption}
)}}\label{a00154_a2f5bb468ce53eb7bbe647e3c11ddbb61}


Definition at line 162 of file Program.\-cs.



References Yarn.\-Program.\-line\-Info, Yarn.\-Program.\-nodes, and Yarn.\-Program.\-strings.


\begin{DoxyCode}
163         \{
164 
165             var sb = \textcolor{keyword}{new} System.Text.StringBuilder();
166 
167             \textcolor{keywordflow}{foreach} (var entry \textcolor{keywordflow}{in} \hyperlink{a00154_a3f4928a577c88263ad016be259b175c4}{nodes})
168             \{
169                 sb.AppendLine(\textcolor{stringliteral}{"Node "} + entry.Key + \textcolor{stringliteral}{":"});
170 
171                 \textcolor{keywordtype}{int} instructionCount = 0;
172                 \textcolor{keywordflow}{foreach} (var instruction \textcolor{keywordflow}{in} entry.Value.instructions)
173                 \{
174                     \textcolor{keywordtype}{string} instructionText;
175 
176                     \textcolor{keywordflow}{if} (instruction.operation == \hyperlink{a00053_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label)
177                     \{
178                         instructionText = instruction.ToString(\textcolor{keyword}{this}, l);
179                     \}
180                     \textcolor{keywordflow}{else}
181                     \{
182                         instructionText = \textcolor{stringliteral}{"    "} + instruction.ToString(\textcolor{keyword}{this}, l);
183                     \}
184 
185                     \textcolor{keywordtype}{string} preface;
186 
187                     \textcolor{keywordflow}{if} (instructionCount % 5 == 0 || instructionCount == entry.Value.instructions.Count - 1
      )
188                     \{
189                         preface = string.Format(CultureInfo.InvariantCulture, \textcolor{stringliteral}{"\{0,6\}   "}, instructionCount)
      ;
190                     \}
191                     \textcolor{keywordflow}{else}
192                     \{
193                         preface = string.Format(CultureInfo.InvariantCulture, \textcolor{stringliteral}{"\{0,6\}   "}, \textcolor{stringliteral}{" "});
194                     \}
195 
196                     sb.AppendLine(preface + instructionText);
197 
198                     instructionCount++;
199                 \}
200 
201                 sb.AppendLine();
202             \}
203 
204             sb.AppendLine(\textcolor{stringliteral}{"String table:"});
205 
206             \textcolor{keywordflow}{foreach} (var entry \textcolor{keywordflow}{in} \hyperlink{a00154_a59263e00cecfe36d9881b4c30b048f09}{strings})
207             \{
208                 var \hyperlink{a00154_a0d4da395947767b4a1eaaff8a9842adc}{lineInfo} = this.lineInfo[entry.Key];
209 
210                 sb.AppendLine(string.Format(CultureInfo.InvariantCulture, \textcolor{stringliteral}{"\{0\}: \{1\} (\{2\}:\{3\})"}, entry.Key, 
      entry.Value, lineInfo.nodeName, lineInfo.lineNumber));
211             \}
212 
213             \textcolor{keywordflow}{return} sb.ToString();
214         \}
\end{DoxyCode}
\hypertarget{a00154_a14737b93594c4aab25c59cb0a3c918f7}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!Get\-String@{Get\-String}}
\index{Get\-String@{Get\-String}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{Get\-String}]{\setlength{\rightskip}{0pt plus 5cm}string Yarn.\-Program.\-Get\-String (
\begin{DoxyParamCaption}
\item[{string}]{key}
\end{DoxyParamCaption}
)}}\label{a00154_a14737b93594c4aab25c59cb0a3c918f7}


Definition at line 155 of file Program.\-cs.


\begin{DoxyCode}
156         \{
157             \textcolor{keywordtype}{string} value = null;
158             strings.TryGetValue(key, out value);
159             \textcolor{keywordflow}{return} value;
160         \}
\end{DoxyCode}
\hypertarget{a00154_a116312a32b20bc18e09f90c9c92a079f}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!Get\-Tags\-For\-Node@{Get\-Tags\-For\-Node}}
\index{Get\-Tags\-For\-Node@{Get\-Tags\-For\-Node}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{Get\-Tags\-For\-Node}]{\setlength{\rightskip}{0pt plus 5cm}I\-Enumerable$<$string$>$ Yarn.\-Program.\-Get\-Tags\-For\-Node (
\begin{DoxyParamCaption}
\item[{string}]{node\-Name}
\end{DoxyParamCaption}
)}}\label{a00154_a116312a32b20bc18e09f90c9c92a079f}


Definition at line 221 of file Program.\-cs.



References Yarn.\-Program.\-nodes.


\begin{DoxyCode}
222         \{
223             \textcolor{keywordflow}{return} \hyperlink{a00154_a3f4928a577c88263ad016be259b175c4}{nodes}[nodeName].tags;
224         \}
\end{DoxyCode}
\hypertarget{a00154_aad8029f37832ff1985fad6a31e51afd8}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!Get\-Text\-For\-Node@{Get\-Text\-For\-Node}}
\index{Get\-Text\-For\-Node@{Get\-Text\-For\-Node}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{Get\-Text\-For\-Node}]{\setlength{\rightskip}{0pt plus 5cm}string Yarn.\-Program.\-Get\-Text\-For\-Node (
\begin{DoxyParamCaption}
\item[{string}]{node\-Name}
\end{DoxyParamCaption}
)}}\label{a00154_aad8029f37832ff1985fad6a31e51afd8}


Definition at line 216 of file Program.\-cs.



References Yarn.\-Program.\-nodes.


\begin{DoxyCode}
217         \{
218             \textcolor{keywordflow}{return} this.GetString(\hyperlink{a00154_a3f4928a577c88263ad016be259b175c4}{nodes}[nodeName].sourceTextStringID);
219         \}
\end{DoxyCode}
\hypertarget{a00154_afd3385ca1f7589b3b9dae3646e4fee84}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!Include@{Include}}
\index{Include@{Include}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{Include}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Program.\-Include (
\begin{DoxyParamCaption}
\item[{{\bf Program}}]{other\-Program}
\end{DoxyParamCaption}
)}}\label{a00154_afd3385ca1f7589b3b9dae3646e4fee84}


Definition at line 226 of file Program.\-cs.



References Yarn.\-Program.\-nodes, and Yarn.\-Program.\-strings.


\begin{DoxyCode}
227         \{
228             \textcolor{keywordflow}{foreach} (var otherNodeName \textcolor{keywordflow}{in} otherProgram.nodes)
229             \{
230 
231                 \textcolor{keywordflow}{if} (\hyperlink{a00154_a3f4928a577c88263ad016be259b175c4}{nodes}.ContainsKey(otherNodeName.Key))
232                 \{
233                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} InvalidOperationException(\textcolor{keywordtype}{string}.Format(CultureInfo.CurrentCulture, \textcolor{stringliteral}{"This
       program already contains a node named \{0\}"}, otherNodeName.Key));
234                 \}
235 
236                 \hyperlink{a00154_a3f4928a577c88263ad016be259b175c4}{nodes}[otherNodeName.Key] = otherNodeName.Value;
237             \}
238 
239             \textcolor{keywordflow}{foreach} (var otherString \textcolor{keywordflow}{in} otherProgram.strings)
240             \{
241 
242                 \textcolor{keywordflow}{if} (\hyperlink{a00154_a3f4928a577c88263ad016be259b175c4}{nodes}.ContainsKey(otherString.Key))
243                 \{
244                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} InvalidOperationException(\textcolor{keywordtype}{string}.Format(CultureInfo.CurrentCulture, \textcolor{stringliteral}{"This
       program already contains a string with key \{0\}"}, otherString.Key));
245                 \}
246 
247                 \hyperlink{a00154_a59263e00cecfe36d9881b4c30b048f09}{strings}[otherString.Key] = otherString.Value;
248             \}
249         \}
\end{DoxyCode}
\hypertarget{a00154_a977d1ed02e3f6f39d30dfea1663e7927}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!Load\-Strings@{Load\-Strings}}
\index{Load\-Strings@{Load\-Strings}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{Load\-Strings}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Program.\-Load\-Strings (
\begin{DoxyParamCaption}
\item[{Dictionary$<$ string, string $>$}]{new\-Strings}
\end{DoxyParamCaption}
)}}\label{a00154_a977d1ed02e3f6f39d30dfea1663e7927}


Loads a new string table into the program. 

The string table is merged with any existing strings, with the new table taking precedence over the old. 

Definition at line 125 of file Program.\-cs.



References Yarn.\-Program.\-strings.


\begin{DoxyCode}
126         \{
127             \textcolor{keywordflow}{foreach} (var entry \textcolor{keywordflow}{in} newStrings)
128             \{
129                 \hyperlink{a00154_a59263e00cecfe36d9881b4c30b048f09}{strings}[entry.Key] = entry.Value;
130             \}
131         \}
\end{DoxyCode}
\hypertarget{a00154_a9baf491479375aa8c3aa2b0c31cf0932}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!Register\-String@{Register\-String}}
\index{Register\-String@{Register\-String}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{Register\-String}]{\setlength{\rightskip}{0pt plus 5cm}string Yarn.\-Program.\-Register\-String (
\begin{DoxyParamCaption}
\item[{string}]{the\-String, }
\item[{string}]{node\-Name, }
\item[{string}]{line\-I\-D, }
\item[{int}]{line\-Number, }
\item[{bool}]{localisable}
\end{DoxyParamCaption}
)}}\label{a00154_a9baf491479375aa8c3aa2b0c31cf0932}


Definition at line 133 of file Program.\-cs.



References Yarn.\-Program.\-string\-Count.


\begin{DoxyCode}
134         \{
135 
136             \textcolor{keywordtype}{string} key;
137 
138             \textcolor{keywordflow}{if} (lineID == null)
139                 key = string.Format(CultureInfo.InvariantCulture, \textcolor{stringliteral}{"\{0\}-\{1\}"}, nodeName, 
      \hyperlink{a00154_a8ef1d10094ef00311aade6715ba78ec7}{stringCount}++);
140             \textcolor{keywordflow}{else}
141                 key = lineID;
142 
143             \textcolor{comment}{// It's not in the list; append it}
144             strings.Add(key, theString);
145 
146             \textcolor{keywordflow}{if} (localisable)
147             \{
148                 \textcolor{comment}{// Additionally, keep info about this string around}
149                 lineInfo.Add(key, \textcolor{keyword}{new} LineInfo(nodeName, lineNumber));
150             \}
151 
152             \textcolor{keywordflow}{return} key;
153         \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\hypertarget{a00154_a0d4da395947767b4a1eaaff8a9842adc}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!line\-Info@{line\-Info}}
\index{line\-Info@{line\-Info}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{line\-Info}]{\setlength{\rightskip}{0pt plus 5cm}Dictionary$<$string, {\bf Line\-Info}$>$ Yarn.\-Program.\-line\-Info = new Dictionary$<$string, {\bf Line\-Info}$>$()\hspace{0.3cm}{\ttfamily [package]}}}\label{a00154_a0d4da395947767b4a1eaaff8a9842adc}


Definition at line 88 of file Program.\-cs.



Referenced by Yarn.\-Program.\-Dump\-Code().

\hypertarget{a00154_a3f4928a577c88263ad016be259b175c4}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!nodes@{nodes}}
\index{nodes@{nodes}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{nodes}]{\setlength{\rightskip}{0pt plus 5cm}Dictionary$<$string, {\bf Node}$>$ Yarn.\-Program.\-nodes = new Dictionary$<$string, {\bf Node}$>$()\hspace{0.3cm}{\ttfamily [package]}}}\label{a00154_a3f4928a577c88263ad016be259b175c4}


Definition at line 91 of file Program.\-cs.



Referenced by Yarn.\-Compiler.\-Compile\-Node(), Yarn.\-Program.\-Dump\-Code(), Yarn.\-Dialogue.\-Get\-Tags\-For\-All\-Nodes(), Yarn.\-Program.\-Get\-Tags\-For\-Node(), Yarn.\-Dialogue.\-Get\-Tags\-For\-Node(), Yarn.\-Dialogue.\-Get\-Text\-For\-All\-Nodes(), Yarn.\-Program.\-Get\-Text\-For\-Node(), Yarn.\-Dialogue.\-Get\-Text\-For\-Node(), Yarn.\-Program.\-Include(), Yarn.\-Dialogue.\-Node\-Exists(), and Yarn.\-Virtual\-Machine.\-Set\-Node().

\hypertarget{a00154_a8ef1d10094ef00311aade6715ba78ec7}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!string\-Count@{string\-Count}}
\index{string\-Count@{string\-Count}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{string\-Count}]{\setlength{\rightskip}{0pt plus 5cm}int Yarn.\-Program.\-string\-Count = 0\hspace{0.3cm}{\ttfamily [private]}}}\label{a00154_a8ef1d10094ef00311aade6715ba78ec7}


Definition at line 119 of file Program.\-cs.



Referenced by Yarn.\-Program.\-Register\-String().

\hypertarget{a00154_a59263e00cecfe36d9881b4c30b048f09}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!strings@{strings}}
\index{strings@{strings}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{strings}]{\setlength{\rightskip}{0pt plus 5cm}Dictionary$<$string, string$>$ Yarn.\-Program.\-strings = new Dictionary$<$string, string$>$()\hspace{0.3cm}{\ttfamily [package]}}}\label{a00154_a59263e00cecfe36d9881b4c30b048f09}


Definition at line 87 of file Program.\-cs.



Referenced by Yarn.\-Program.\-Dump\-Code(), Yarn.\-Program.\-Include(), and Yarn.\-Program.\-Load\-Strings().



\subsection{Property Documentation}
\hypertarget{a00154_aa8fedbfceaf931d1da3f600eaab6ae87}{\index{Yarn\-::\-Program@{Yarn\-::\-Program}!untagged\-Strings@{untagged\-Strings}}
\index{untagged\-Strings@{untagged\-Strings}!Yarn::Program@{Yarn\-::\-Program}}
\subsubsection[{untagged\-Strings}]{\setlength{\rightskip}{0pt plus 5cm}Dictionary$<$string, string$>$ Yarn.\-Program.\-untagged\-Strings\hspace{0.3cm}{\ttfamily [get]}, {\ttfamily [package]}}}\label{a00154_aa8fedbfceaf931d1da3f600eaab6ae87}


Definition at line 103 of file Program.\-cs.



The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
Yarn\-Spinner/\hyperlink{a00317}{Program.\-cs}\end{DoxyCompactItemize}
