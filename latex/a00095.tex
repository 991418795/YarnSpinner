\hypertarget{a00095}{\section{Yarn.\-File\-Format\-Converter Class Reference}
\label{a00095}\index{Yarn.\-File\-Format\-Converter@{Yarn.\-File\-Format\-Converter}}
}


Collaboration diagram for Yarn.\-File\-Format\-Converter\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{a00710}
\end{center}
\end{figure}
\subsection*{Static Package Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{a00095_aa4db4ccac799c5f047a8b1a9efbe109d}{Convert\-Format} (\hyperlink{a00048}{Convert\-Format\-Options} options)
\item 
static string \hyperlink{a00095_a85596df924468279b2dc44a9f31d8bad}{Convert\-Nodes} (I\-Enumerable$<$ \hyperlink{a00130}{Loader.\-Node\-Info} $>$ nodes, \hyperlink{a00041_ad7ebb46e7309ead8767383a672b3272f}{Node\-Format} format)
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
delegate string \hyperlink{a00095_af9bd5d832fdd2bcbdc626d9f8632e05c}{Convert\-Nodes\-To\-Text} (I\-Enumerable$<$ \hyperlink{a00130}{Loader.\-Node\-Info} $>$ nodes)
\end{DoxyCompactItemize}
\subsection*{Static Private Member Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{a00095_a28a086a7b44ecea7430af40436f38df6}{Convert\-To\-J\-S\-O\-N} (\hyperlink{a00048}{Convert\-Format\-Options} options)
\item 
static int \hyperlink{a00095_a1e6cd39b0c813f21da278367dcff76d2}{Convert\-To\-Yarn} (\hyperlink{a00048}{Convert\-Format\-Options} options)
\item 
static string \hyperlink{a00095_a282f283f02c9b1d3e53d813ec2f35233}{Convert\-Nodes\-To\-Yarn\-Text} (I\-Enumerable$<$ \hyperlink{a00130}{Loader.\-Node\-Info} $>$ nodes)
\item 
static void \hyperlink{a00095_aa72838be584177b5592c31d73c0febdb}{Convert\-Nodes\-In\-File} (\hyperlink{a00048}{Convert\-Format\-Options} options, string file, string file\-Extension, \hyperlink{a00095_af9bd5d832fdd2bcbdc626d9f8632e05c}{Convert\-Nodes\-To\-Text} convert)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 8 of file File\-Format\-Converter.\-cs.



\subsection{Member Function Documentation}
\hypertarget{a00095_aa4db4ccac799c5f047a8b1a9efbe109d}{\index{Yarn\-::\-File\-Format\-Converter@{Yarn\-::\-File\-Format\-Converter}!Convert\-Format@{Convert\-Format}}
\index{Convert\-Format@{Convert\-Format}!Yarn::FileFormatConverter@{Yarn\-::\-File\-Format\-Converter}}
\subsubsection[{Convert\-Format}]{\setlength{\rightskip}{0pt plus 5cm}static int Yarn.\-File\-Format\-Converter.\-Convert\-Format (
\begin{DoxyParamCaption}
\item[{{\bf Convert\-Format\-Options}}]{options}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [package]}}}\label{a00095_aa4db4ccac799c5f047a8b1a9efbe109d}


Definition at line 10 of file File\-Format\-Converter.\-cs.



References Yarn.\-Yarn\-Spinner\-Console.\-A\-L\-L\-O\-W\-E\-D\-\_\-\-E\-X\-T\-E\-N\-S\-I\-O\-N\-S, Yarn.\-File\-Format\-Converter.\-Convert\-To\-J\-S\-O\-N(), Yarn.\-Convert\-Format\-Options.\-convert\-To\-J\-S\-O\-N, Yarn.\-File\-Format\-Converter.\-Convert\-To\-Yarn(), and Yarn.\-Convert\-Format\-Options.\-convert\-To\-Yarn.



Referenced by Yarn.\-Yarn\-Spinner\-Console.\-Main().


\begin{DoxyCode}
11         \{
12 
13             YarnSpinnerConsole.CheckFileList(options.files, 
      \hyperlink{a00185_a0979de7ea02c8c0375b8220a12e6575e}{YarnSpinnerConsole.ALLOWED\_EXTENSIONS});
14 
15             \textcolor{keywordflow}{if} (options.convertToJSON)
16             \{
17                 \textcolor{keywordflow}{return} \hyperlink{a00095_a28a086a7b44ecea7430af40436f38df6}{ConvertToJSON}(options);
18             \}
19             \textcolor{keywordflow}{if} (options.convertToYarn)
20             \{
21                 \textcolor{keywordflow}{return} \hyperlink{a00095_a1e6cd39b0c813f21da278367dcff76d2}{ConvertToYarn}(options);
22             \}
23 
24             var processName = System.IO.Path.GetFileName(Environment.GetCommandLineArgs()[0]);
25 
26             YarnSpinnerConsole.Error(string.Format(\textcolor{stringliteral}{"You must specify a destination format. Run '\{0\} help
       convert' to learn more."}, processName));
27             \textcolor{keywordflow}{return} 1;
28         \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_aa4db4ccac799c5f047a8b1a9efbe109d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_aa4db4ccac799c5f047a8b1a9efbe109d_icgraph}
\end{center}
\end{figure}


\hypertarget{a00095_a85596df924468279b2dc44a9f31d8bad}{\index{Yarn\-::\-File\-Format\-Converter@{Yarn\-::\-File\-Format\-Converter}!Convert\-Nodes@{Convert\-Nodes}}
\index{Convert\-Nodes@{Convert\-Nodes}!Yarn::FileFormatConverter@{Yarn\-::\-File\-Format\-Converter}}
\subsubsection[{Convert\-Nodes}]{\setlength{\rightskip}{0pt plus 5cm}static string Yarn.\-File\-Format\-Converter.\-Convert\-Nodes (
\begin{DoxyParamCaption}
\item[{I\-Enumerable$<$ {\bf Loader.\-Node\-Info} $>$}]{nodes, }
\item[{{\bf Node\-Format}}]{format}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [package]}}}\label{a00095_a85596df924468279b2dc44a9f31d8bad}


Definition at line 62 of file File\-Format\-Converter.\-cs.



References Yarn.\-File\-Format\-Converter.\-Convert\-Nodes\-To\-Yarn\-Text().


\begin{DoxyCode}
62                                                                                                    \{
63             \textcolor{keywordflow}{switch} (format)
64             \{
65                 \textcolor{keywordflow}{case} NodeFormat.JSON:
66                     \textcolor{keywordflow}{return} JsonConvert.SerializeObject(nodes, Formatting.Indented);
67                 \textcolor{keywordflow}{case} NodeFormat.Text:
68                     \textcolor{keywordflow}{return} \hyperlink{a00095_a282f283f02c9b1d3e53d813ec2f35233}{ConvertNodesToYarnText}(nodes);
69                 \textcolor{keywordflow}{default}:
70                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException();
71             \}
72         \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_a85596df924468279b2dc44a9f31d8bad_cgraph}
\end{center}
\end{figure}


\hypertarget{a00095_aa72838be584177b5592c31d73c0febdb}{\index{Yarn\-::\-File\-Format\-Converter@{Yarn\-::\-File\-Format\-Converter}!Convert\-Nodes\-In\-File@{Convert\-Nodes\-In\-File}}
\index{Convert\-Nodes\-In\-File@{Convert\-Nodes\-In\-File}!Yarn::FileFormatConverter@{Yarn\-::\-File\-Format\-Converter}}
\subsubsection[{Convert\-Nodes\-In\-File}]{\setlength{\rightskip}{0pt plus 5cm}static void Yarn.\-File\-Format\-Converter.\-Convert\-Nodes\-In\-File (
\begin{DoxyParamCaption}
\item[{{\bf Convert\-Format\-Options}}]{options, }
\item[{string}]{file, }
\item[{string}]{file\-Extension, }
\item[{{\bf Convert\-Nodes\-To\-Text}}]{convert}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}}\label{a00095_aa72838be584177b5592c31d73c0febdb}


Definition at line 143 of file File\-Format\-Converter.\-cs.



References Yarn.\-Base\-Options.\-verbose.



Referenced by Yarn.\-File\-Format\-Converter.\-Convert\-To\-J\-S\-O\-N(), and Yarn.\-File\-Format\-Converter.\-Convert\-To\-Yarn().


\begin{DoxyCode}
144         \{
145             var d = \textcolor{keyword}{new} Dialogue(null);
146 
147             var text = File.ReadAllText(file);
148 
149             IEnumerable<Loader.NodeInfo> nodes;
150             \textcolor{keywordflow}{try} \{
151                 nodes = d.loader.GetNodesFromText(text, Loader.GetFormatFromFileName(file));
152             \} \textcolor{keywordflow}{catch} (FormatException e) \{
153                 YarnSpinnerConsole.Error(e.Message);
154                 \textcolor{keywordflow}{return};
155             \}
156 
157             var serialisedText = convert(nodes);
158 
159             var destinationDirectory = options.outputDirectory;
160 
161             \textcolor{keywordflow}{if} (destinationDirectory == null)
162             \{
163                 destinationDirectory = Path.GetDirectoryName(file);
164             \}
165 
166             var fileName = Path.GetFileName(file);
167 
168             \textcolor{comment}{// ChangeExtension thinks that the file "Foo.yarn.txt" has the extension "txt", so}
169             \textcolor{comment}{// to simplify things, just lop that extension off right away if it's there}
170             fileName = fileName.Replace(\textcolor{stringliteral}{".yarn.txt"}, \textcolor{stringliteral}{""});
171 
172             \textcolor{comment}{// change the filename's extension}
173             fileName = Path.ChangeExtension(fileName, fileExtension);
174 
175             \textcolor{comment}{// figure out where we're writing this file}
176             var destinationFilePath = Path.Combine(destinationDirectory, fileName);
177 
178             File.WriteAllText(destinationFilePath, serialisedText);
179 
180             \textcolor{keywordflow}{if} (options.verbose)
181             \{
182                 YarnSpinnerConsole.Note(\textcolor{stringliteral}{"Wrote "} + destinationFilePath);
183             \}
184         \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_aa72838be584177b5592c31d73c0febdb_icgraph}
\end{center}
\end{figure}


\hypertarget{a00095_af9bd5d832fdd2bcbdc626d9f8632e05c}{\index{Yarn\-::\-File\-Format\-Converter@{Yarn\-::\-File\-Format\-Converter}!Convert\-Nodes\-To\-Text@{Convert\-Nodes\-To\-Text}}
\index{Convert\-Nodes\-To\-Text@{Convert\-Nodes\-To\-Text}!Yarn::FileFormatConverter@{Yarn\-::\-File\-Format\-Converter}}
\subsubsection[{Convert\-Nodes\-To\-Text}]{\setlength{\rightskip}{0pt plus 5cm}delegate string Yarn.\-File\-Format\-Converter.\-Convert\-Nodes\-To\-Text (
\begin{DoxyParamCaption}
\item[{I\-Enumerable$<$ {\bf Loader.\-Node\-Info} $>$}]{nodes}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00095_af9bd5d832fdd2bcbdc626d9f8632e05c}
\hypertarget{a00095_a282f283f02c9b1d3e53d813ec2f35233}{\index{Yarn\-::\-File\-Format\-Converter@{Yarn\-::\-File\-Format\-Converter}!Convert\-Nodes\-To\-Yarn\-Text@{Convert\-Nodes\-To\-Yarn\-Text}}
\index{Convert\-Nodes\-To\-Yarn\-Text@{Convert\-Nodes\-To\-Yarn\-Text}!Yarn::FileFormatConverter@{Yarn\-::\-File\-Format\-Converter}}
\subsubsection[{Convert\-Nodes\-To\-Yarn\-Text}]{\setlength{\rightskip}{0pt plus 5cm}static string Yarn.\-File\-Format\-Converter.\-Convert\-Nodes\-To\-Yarn\-Text (
\begin{DoxyParamCaption}
\item[{I\-Enumerable$<$ {\bf Loader.\-Node\-Info} $>$}]{nodes}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}}\label{a00095_a282f283f02c9b1d3e53d813ec2f35233}


Definition at line 74 of file File\-Format\-Converter.\-cs.



Referenced by Yarn.\-File\-Format\-Converter.\-Convert\-Nodes(), and Yarn.\-File\-Format\-Converter.\-Convert\-To\-Yarn().


\begin{DoxyCode}
75         \{
76             var sb = \textcolor{keyword}{new} System.Text.StringBuilder();
77 
78             var properties = typeof(Loader.NodeInfo).GetProperties();
79 
80             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} nodes) \{
81 
82                 \textcolor{keywordflow}{foreach} (var property \textcolor{keywordflow}{in} properties) \{
83 
84                     \textcolor{comment}{// ignore the body attribute}
85                     \textcolor{keywordflow}{if} (property.Name == \textcolor{stringliteral}{"body"}) \{
86                         \textcolor{keywordflow}{continue};
87                     \}
88 
89                     \textcolor{comment}{// piggy-back off the JsonIgnoreAttribute to sense items that should not be serialised}
90                     \textcolor{keywordflow}{if} (property.GetCustomAttributes(typeof(JsonIgnoreAttribute), \textcolor{keyword}{false}).Length > 0) \{
91                         \textcolor{keywordflow}{continue};
92                     \}
93 
94                     var field = property.Name;
95 
96                     \textcolor{keywordtype}{string} value;
97 
98                     var propertyType = property.PropertyType;
99                     \textcolor{keywordflow}{if} (propertyType.IsAssignableFrom(typeof(\textcolor{keywordtype}{string})))
100                     \{
101                         value = (string)property.GetValue(node, null);
102 
103                         \textcolor{comment}{// avoid storing nulls when we could store the empty string instead}
104                         \textcolor{keywordflow}{if} (value == null)
105                             value = \textcolor{stringliteral}{""};
106                     \}
107                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (propertyType.IsAssignableFrom(typeof(\textcolor{keywordtype}{int})))
108                     \{
109                         value = ((int)property.GetValue(node, null)).ToString();
110                     \}
111                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (propertyType.IsAssignableFrom(typeof(Loader.NodeInfo.Position)))
112                     \{
113                         var position = (Loader.NodeInfo.Position)property.GetValue(node, null);
114 
115                         value = string.Format(\textcolor{stringliteral}{"\{0\},\{1\}"}, position.x, position.y);
116                     \} \textcolor{keywordflow}{else} \{
117                         YarnSpinnerConsole.Error(string.Format(\textcolor{stringliteral}{"Internal error: Node \{0\}'s property \{1\} has
       unsupported type \{2\}"}, node.title, property.Name, propertyType.FullName));
118 
119                         \textcolor{comment}{// will never be run, but prevents the compiler being mean about us not returning a
       value}
120                         \textcolor{keywordflow}{throw} \textcolor{keyword}{new} Exception();
121                     \}
122 
123                     var header = string.Format(\textcolor{stringliteral}{"\{0\}: \{1\}"}, field, value);
124 
125                     sb.AppendLine(header);
126 
127                 \}
128                 \textcolor{comment}{// now write the body}
129                 sb.AppendLine(\textcolor{stringliteral}{"---"});
130 
131                 sb.AppendLine(node.body);
132 
133                 sb.AppendLine(\textcolor{stringliteral}{"==="});
134 
135             \}
136 
137             \textcolor{keywordflow}{return} sb.ToString();
138         \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_a282f283f02c9b1d3e53d813ec2f35233_icgraph}
\end{center}
\end{figure}


\hypertarget{a00095_a28a086a7b44ecea7430af40436f38df6}{\index{Yarn\-::\-File\-Format\-Converter@{Yarn\-::\-File\-Format\-Converter}!Convert\-To\-J\-S\-O\-N@{Convert\-To\-J\-S\-O\-N}}
\index{Convert\-To\-J\-S\-O\-N@{Convert\-To\-J\-S\-O\-N}!Yarn::FileFormatConverter@{Yarn\-::\-File\-Format\-Converter}}
\subsubsection[{Convert\-To\-J\-S\-O\-N}]{\setlength{\rightskip}{0pt plus 5cm}static int Yarn.\-File\-Format\-Converter.\-Convert\-To\-J\-S\-O\-N (
\begin{DoxyParamCaption}
\item[{{\bf Convert\-Format\-Options}}]{options}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}}\label{a00095_a28a086a7b44ecea7430af40436f38df6}


Definition at line 30 of file File\-Format\-Converter.\-cs.



References Yarn.\-File\-Format\-Converter.\-Convert\-Nodes\-In\-File(), and Yarn.\-Loader.\-Get\-Format\-From\-File\-Name().



Referenced by Yarn.\-File\-Format\-Converter.\-Convert\-Format().


\begin{DoxyCode}
31         \{
32             \textcolor{keywordflow}{foreach} (var file \textcolor{keywordflow}{in} options.files)
33             \{
34 
35                 \textcolor{keywordflow}{if} (Loader.GetFormatFromFileName(file) == NodeFormat.JSON)
36                 \{
37                     YarnSpinnerConsole.Warn(string.Format(\textcolor{stringliteral}{"Not converting file \{0\}, because its name
       implies it's already in JSON format"}, file));
38                     \textcolor{keywordflow}{continue};
39                 \}
40 
41                 \hyperlink{a00095_aa72838be584177b5592c31d73c0febdb}{ConvertNodesInFile}(options, file, \textcolor{stringliteral}{"json"}, (IEnumerable<Loader.NodeInfo> 
      nodes) => JsonConvert.SerializeObject(nodes, Formatting.Indented));
42 
43             \}
44             \textcolor{keywordflow}{return} 0;
45         \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_a28a086a7b44ecea7430af40436f38df6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_a28a086a7b44ecea7430af40436f38df6_icgraph}
\end{center}
\end{figure}


\hypertarget{a00095_a1e6cd39b0c813f21da278367dcff76d2}{\index{Yarn\-::\-File\-Format\-Converter@{Yarn\-::\-File\-Format\-Converter}!Convert\-To\-Yarn@{Convert\-To\-Yarn}}
\index{Convert\-To\-Yarn@{Convert\-To\-Yarn}!Yarn::FileFormatConverter@{Yarn\-::\-File\-Format\-Converter}}
\subsubsection[{Convert\-To\-Yarn}]{\setlength{\rightskip}{0pt plus 5cm}static int Yarn.\-File\-Format\-Converter.\-Convert\-To\-Yarn (
\begin{DoxyParamCaption}
\item[{{\bf Convert\-Format\-Options}}]{options}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}}\label{a00095_a1e6cd39b0c813f21da278367dcff76d2}


Definition at line 47 of file File\-Format\-Converter.\-cs.



References Yarn.\-File\-Format\-Converter.\-Convert\-Nodes\-In\-File(), Yarn.\-File\-Format\-Converter.\-Convert\-Nodes\-To\-Yarn\-Text(), and Yarn.\-Loader.\-Get\-Format\-From\-File\-Name().



Referenced by Yarn.\-File\-Format\-Converter.\-Convert\-Format().


\begin{DoxyCode}
48         \{
49             \textcolor{keywordflow}{foreach} (var file \textcolor{keywordflow}{in} options.files)
50             \{
51                 \textcolor{keywordflow}{if} (Loader.GetFormatFromFileName(file) == NodeFormat.Text)
52                 \{
53                     YarnSpinnerConsole.Warn(string.Format(\textcolor{stringliteral}{"Not converting file \{0\}, because its name
       implies it's already in Yarn format"}, file));
54                     \textcolor{keywordflow}{continue};
55                 \}
56 
57                 \hyperlink{a00095_aa72838be584177b5592c31d73c0febdb}{ConvertNodesInFile}(options, file, \textcolor{stringliteral}{"yarn.txt"}, 
      \hyperlink{a00095_a282f283f02c9b1d3e53d813ec2f35233}{ConvertNodesToYarnText});
58             \}
59             \textcolor{keywordflow}{return} 0;
60         \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_a1e6cd39b0c813f21da278367dcff76d2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00095_a1e6cd39b0c813f21da278367dcff76d2_icgraph}
\end{center}
\end{figure}




The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
Yarn\-Spinner\-Console/\hyperlink{a00305}{File\-Format\-Converter.\-cs}\end{DoxyCompactItemize}
