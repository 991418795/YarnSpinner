\hypertarget{a00117}{\section{Yarn.\-Lexer Class Reference}
\label{a00117}\index{Yarn.\-Lexer@{Yarn.\-Lexer}}
}


Collaboration diagram for Yarn.\-Lexer\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=224pt]{a00630}
\end{center}
\end{figure}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{a00118}{Lexer\-State}
\item 
class \hyperlink{a00166}{Token\-Rule}
\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{a00117_a4bf394bcf675142f33c90541be7dd571}{Lexer} ()
\item 
\hyperlink{a00165}{Token\-List} \hyperlink{a00117_a6a09f1bb13f28acd95fd081954b45437}{Tokenise} (string title, string text)
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{a00117_a646081a52b241abaafe5e0cfaeafd751}{Create\-States} ()
\item 
\hyperlink{a00165}{Token\-List} \hyperlink{a00117_a20b63f6ef434f6a40fd388f262f03fa8}{Tokenise\-Line} (string line, int line\-Number)
\item 
int \hyperlink{a00117_a4079b10b099e5d85f5482f9e7eac4179}{Line\-Indentation} (string line)
\item 
void \hyperlink{a00117_ad3ef08f822b310d9864774b057b96995}{Enter\-State} (\hyperlink{a00118}{Lexer\-State} state)
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
const string \hyperlink{a00117_a29c457125cc4876f8571f5d9afa372e2}{L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T} = \char`\"{}//\char`\"{}
\item 
Dictionary$<$ string, \hyperlink{a00118}{Lexer\-State} $>$ \hyperlink{a00117_a2c65c0ba90f973e459583badefef216a}{states}
\item 
\hyperlink{a00118}{Lexer\-State} \hyperlink{a00117_a16b5dbf27a377cde5e8ba0eaa05b5710}{default\-State}
\item 
\hyperlink{a00118}{Lexer\-State} \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{current\-State}
\item 
Stack$<$ Key\-Value\-Pair$<$ int, bool $>$ $>$ \hyperlink{a00117_a6631a1b1a9109258ab18927e7587ff9b}{indentation\-Stack}
\item 
bool \hyperlink{a00117_ac670aac2245cbd4694dfbd5b69313218}{should\-Track\-Next\-Indentation}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 211 of file Lexer.\-cs.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{a00117_a4bf394bcf675142f33c90541be7dd571}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!Lexer@{Lexer}}
\index{Lexer@{Lexer}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{Lexer}]{\setlength{\rightskip}{0pt plus 5cm}Yarn.\-Lexer.\-Lexer (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{a00117_a4bf394bcf675142f33c90541be7dd571}


Definition at line 316 of file Lexer.\-cs.



References Yarn.\-Lexer.\-Create\-States().


\begin{DoxyCode}
317         \{
318             \hyperlink{a00117_a646081a52b241abaafe5e0cfaeafd751}{CreateStates} ();
319         \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{a00117_a4bf394bcf675142f33c90541be7dd571_cgraph}
\end{center}
\end{figure}




\subsection{Member Function Documentation}
\hypertarget{a00117_a646081a52b241abaafe5e0cfaeafd751}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!Create\-States@{Create\-States}}
\index{Create\-States@{Create\-States}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{Create\-States}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Lexer.\-Create\-States (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_a646081a52b241abaafe5e0cfaeafd751}


Definition at line 321 of file Lexer.\-cs.



References Yarn.\-Lexer.\-default\-State, and Yarn.\-Lexer.\-states.



Referenced by Yarn.\-Lexer.\-Lexer().


\begin{DoxyCode}
322         \{
323 
324             var patterns = \textcolor{keyword}{new} Dictionary<TokenType, string> ();
325 
326             patterns[TokenType.Text] = \textcolor{stringliteral}{".*"};
327 
328             patterns[TokenType.Number] = \textcolor{stringliteral}{@"\(\backslash\)-?[0-9]+(\(\backslash\).[0-9+])?"};
329             patterns[TokenType.String] = \textcolor{stringliteral}{@"""([^""\(\backslash\)\(\backslash\)]*(?:\(\backslash\)\(\backslash\).[^""\(\backslash\)\(\backslash\)]*)*)"""};
330             patterns[TokenType.TagMarker] = \textcolor{stringliteral}{@"\(\backslash\)#"};
331             patterns[TokenType.LeftParen] = \textcolor{stringliteral}{@"\(\backslash\)("};
332             patterns[TokenType.RightParen] = \textcolor{stringliteral}{@"\(\backslash\))"};
333             patterns[TokenType.EqualTo] = \textcolor{stringliteral}{@"(==|is(?!\(\backslash\)w)|eq(?!\(\backslash\)w))"};
334             patterns[TokenType.EqualToOrAssign] = \textcolor{stringliteral}{@"(=|to(?!\(\backslash\)w))"};
335             patterns[TokenType.NotEqualTo] = \textcolor{stringliteral}{@"(\(\backslash\)!=|neq(?!\(\backslash\)w))"};
336             patterns[TokenType.GreaterThanOrEqualTo] = \textcolor{stringliteral}{@"(\(\backslash\)>=|gte(?!\(\backslash\)w))"};
337             patterns[TokenType.GreaterThan] = \textcolor{stringliteral}{@"(\(\backslash\)>|gt(?!\(\backslash\)w))"};
338             patterns[TokenType.LessThanOrEqualTo] = \textcolor{stringliteral}{@"(\(\backslash\)<=|lte(?!\(\backslash\)w))"};
339             patterns[TokenType.LessThan] = \textcolor{stringliteral}{@"(\(\backslash\)<|lt(?!\(\backslash\)w))"};
340             patterns[TokenType.AddAssign] = \textcolor{stringliteral}{@"\(\backslash\)+="};
341             patterns[TokenType.MinusAssign] = \textcolor{stringliteral}{@"\(\backslash\)-="};
342             patterns[TokenType.MultiplyAssign] = \textcolor{stringliteral}{@"\(\backslash\)*="};
343             patterns[TokenType.DivideAssign] = \textcolor{stringliteral}{@"\(\backslash\)/="};
344             patterns[TokenType.Add] = \textcolor{stringliteral}{@"\(\backslash\)+"};
345             patterns[TokenType.Minus] = \textcolor{stringliteral}{@"\(\backslash\)-"};
346             patterns[TokenType.Multiply] = \textcolor{stringliteral}{@"\(\backslash\)*"};
347             patterns[TokenType.Divide] = \textcolor{stringliteral}{@"\(\backslash\)/"};
348             patterns[TokenType.Modulo] = \textcolor{stringliteral}{@"\(\backslash\)%"};
349             patterns[TokenType.And] = \textcolor{stringliteral}{@"(\(\backslash\)&\(\backslash\)&|and(?!\(\backslash\)w))"};
350             patterns[TokenType.Or] = \textcolor{stringliteral}{@"(\(\backslash\)|\(\backslash\)||or(?!\(\backslash\)w))"};
351             patterns[TokenType.Xor] = \textcolor{stringliteral}{@"(\(\backslash\)^|xor(?!\(\backslash\)w))"};
352             patterns[TokenType.Not] = \textcolor{stringliteral}{@"(\(\backslash\)!|not(?!\(\backslash\)w))"};
353             patterns[TokenType.Variable] = \textcolor{stringliteral}{@"\(\backslash\)$([A-Za-z0-9\_\(\backslash\).])+"};
354             patterns[TokenType.Comma] = \textcolor{stringliteral}{@","};
355             patterns[TokenType.True] = \textcolor{stringliteral}{@"true(?!\(\backslash\)w)"};
356             patterns[TokenType.False] = \textcolor{stringliteral}{@"false(?!\(\backslash\)w)"};
357             patterns[TokenType.Null] = \textcolor{stringliteral}{@"null(?!\(\backslash\)w)"};
358 
359             patterns[TokenType.BeginCommand] = \textcolor{stringliteral}{@"\(\backslash\)<\(\backslash\)<"};
360             patterns[TokenType.EndCommand] = \textcolor{stringliteral}{@"\(\backslash\)>\(\backslash\)>"};
361 
362             patterns[TokenType.OptionStart] = \textcolor{stringliteral}{@"\(\backslash\)[\(\backslash\)["};
363             patterns[TokenType.OptionEnd] = \textcolor{stringliteral}{@"\(\backslash\)]\(\backslash\)]"};
364             patterns[TokenType.OptionDelimit] = \textcolor{stringliteral}{@"\(\backslash\)|"};
365 
366             patterns[TokenType.Identifier] = \textcolor{stringliteral}{@"[a-zA-Z0-9\_:\(\backslash\).]+"};
367 
368             patterns[TokenType.If] = \textcolor{stringliteral}{@"if(?!\(\backslash\)w)"};
369             patterns[TokenType.Else] = \textcolor{stringliteral}{@"else(?!\(\backslash\)w)"};
370             patterns[TokenType.ElseIf] = \textcolor{stringliteral}{@"elseif(?!\(\backslash\)w)"};
371             patterns[TokenType.EndIf] = \textcolor{stringliteral}{@"endif(?!\(\backslash\)w)"};
372             patterns[TokenType.Set] = \textcolor{stringliteral}{@"set(?!\(\backslash\)w)"};
373 
374             patterns[TokenType.ShortcutOption] = \textcolor{stringliteral}{@"\(\backslash\)-\(\backslash\)>"};
375 
376             \hyperlink{a00117_a2c65c0ba90f973e459583badefef216a}{states} = \textcolor{keyword}{new} Dictionary<string, LexerState> ();
377 
378             \hyperlink{a00117_a2c65c0ba90f973e459583badefef216a}{states} [\textcolor{stringliteral}{"base"}] = \textcolor{keyword}{new} LexerState (patterns);
379             states [\textcolor{stringliteral}{"base"}].AddTransition(TokenType.BeginCommand, \textcolor{stringliteral}{"command"}, delimitsText:\textcolor{keyword}{true});
380             states [\textcolor{stringliteral}{"base"}].AddTransition(TokenType.OptionStart, \textcolor{stringliteral}{"link"}, delimitsText:\textcolor{keyword}{true});
381             states [\textcolor{stringliteral}{"base"}].AddTransition(TokenType.ShortcutOption, \textcolor{stringliteral}{"shortcut-option"});
382             states [\textcolor{stringliteral}{"base"}].AddTransition (TokenType.TagMarker, \textcolor{stringliteral}{"tag"}, delimitsText: \textcolor{keyword}{true});
383             states [\textcolor{stringliteral}{"base"}].AddTextRule (TokenType.Text);
384 
385             states [\textcolor{stringliteral}{"tag"}] = \textcolor{keyword}{new} LexerState (patterns);
386             states [\textcolor{stringliteral}{"tag"}].AddTransition (TokenType.Identifier, \textcolor{stringliteral}{"base"});
387 
388             states [\textcolor{stringliteral}{"shortcut-option"}] = \textcolor{keyword}{new} LexerState (patterns);
389             states [\textcolor{stringliteral}{"shortcut-option"}].setTrackNextIndentation = \textcolor{keyword}{true};
390             states [\textcolor{stringliteral}{"shortcut-option"}].AddTransition (TokenType.BeginCommand, \textcolor{stringliteral}{"expression"}, delimitsText: \textcolor{keyword}{
      true});
391             states [\textcolor{stringliteral}{"shortcut-option"}].AddTransition (TokenType.TagMarker, \textcolor{stringliteral}{"shortcut-option-tag"}, 
      delimitsText: \textcolor{keyword}{true});
392             states [\textcolor{stringliteral}{"shortcut-option"}].AddTextRule (TokenType.Text, \textcolor{stringliteral}{"base"});
393 
394             states [\textcolor{stringliteral}{"shortcut-option-tag"}] = \textcolor{keyword}{new} LexerState (patterns);
395             states [\textcolor{stringliteral}{"shortcut-option-tag"}].AddTransition (TokenType.Identifier, \textcolor{stringliteral}{"shortcut-option"});
396 
397             states [\textcolor{stringliteral}{"command"}] = \textcolor{keyword}{new} LexerState (patterns);
398             states [\textcolor{stringliteral}{"command"}].AddTransition (TokenType.If, \textcolor{stringliteral}{"expression"});
399             states [\textcolor{stringliteral}{"command"}].AddTransition (TokenType.Else);
400             states [\textcolor{stringliteral}{"command"}].AddTransition (TokenType.ElseIf, \textcolor{stringliteral}{"expression"});
401             states [\textcolor{stringliteral}{"command"}].AddTransition (TokenType.EndIf);
402             states [\textcolor{stringliteral}{"command"}].AddTransition (TokenType.Set, \textcolor{stringliteral}{"assignment"});
403             states [\textcolor{stringliteral}{"command"}].AddTransition (TokenType.EndCommand,  \textcolor{stringliteral}{"base"}, delimitsText: \textcolor{keyword}{true});
404             states [\textcolor{stringliteral}{"command"}].AddTransition (TokenType.Identifier, \textcolor{stringliteral}{"command-or-expression"});
405             states [\textcolor{stringliteral}{"command"}].AddTextRule (TokenType.Text);
406 
407             states [\textcolor{stringliteral}{"command-or-expression"}] = \textcolor{keyword}{new} LexerState (patterns);
408             states [\textcolor{stringliteral}{"command-or-expression"}].AddTransition (TokenType.LeftParen, \textcolor{stringliteral}{"expression"});
409             states [\textcolor{stringliteral}{"command-or-expression"}].AddTransition (TokenType.EndCommand, \textcolor{stringliteral}{"base"}, delimitsText:\textcolor{keyword}{true}
      );
410             states [\textcolor{stringliteral}{"command-or-expression"}].AddTextRule (TokenType.Text);
411 
412             states [\textcolor{stringliteral}{"assignment"}] = \textcolor{keyword}{new} LexerState (patterns);
413             states [\textcolor{stringliteral}{"assignment"}].AddTransition(TokenType.Variable);
414             states [\textcolor{stringliteral}{"assignment"}].AddTransition(TokenType.EqualToOrAssign, \textcolor{stringliteral}{"expression"});
415             states [\textcolor{stringliteral}{"assignment"}].AddTransition(TokenType.AddAssign, \textcolor{stringliteral}{"expression"});
416             states [\textcolor{stringliteral}{"assignment"}].AddTransition(TokenType.MinusAssign, \textcolor{stringliteral}{"expression"});
417             states [\textcolor{stringliteral}{"assignment"}].AddTransition(TokenType.MultiplyAssign, \textcolor{stringliteral}{"expression"});
418             states [\textcolor{stringliteral}{"assignment"}].AddTransition(TokenType.DivideAssign, \textcolor{stringliteral}{"expression"});
419 
420             states [\textcolor{stringliteral}{"expression"}] = \textcolor{keyword}{new} LexerState (patterns);
421             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.EndCommand, \textcolor{stringliteral}{"base"});
422             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Number);
423             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.String);
424             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.LeftParen);
425             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.RightParen);
426             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.EqualTo);
427             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.EqualToOrAssign);
428             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.NotEqualTo);
429             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.GreaterThanOrEqualTo);
430             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.GreaterThan);
431             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.LessThanOrEqualTo);
432             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.LessThan);
433             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Add);
434             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Minus);
435             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Multiply);
436             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Divide);
437             states [\textcolor{stringliteral}{"expression"}].AddTransition (TokenType.Modulo);
438             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.And);
439             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Or);
440             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Xor);
441             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Not);
442             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Variable);
443             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Comma);
444             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.True);
445             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.False);
446             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Null);
447             states [\textcolor{stringliteral}{"expression"}].AddTransition(TokenType.Identifier);
448 
449             states [\textcolor{stringliteral}{"link"}] = \textcolor{keyword}{new} LexerState (patterns);
450             states [\textcolor{stringliteral}{"link"}].AddTransition (TokenType.OptionEnd, \textcolor{stringliteral}{"base"}, delimitsText:\textcolor{keyword}{true});
451             states [\textcolor{stringliteral}{"link"}].AddTransition (TokenType.OptionDelimit, \textcolor{stringliteral}{"link-destination"}, delimitsText:\textcolor{keyword}{true});
452             states [\textcolor{stringliteral}{"link"}].AddTextRule (TokenType.Text);
453 
454             states [\textcolor{stringliteral}{"link-destination"}] = \textcolor{keyword}{new} LexerState (patterns);
455             states [\textcolor{stringliteral}{"link-destination"}].AddTransition (TokenType.Identifier);
456             states [\textcolor{stringliteral}{"link-destination"}].AddTransition (TokenType.OptionEnd, \textcolor{stringliteral}{"base"});
457 
458             \hyperlink{a00117_a16b5dbf27a377cde5e8ba0eaa05b5710}{defaultState} = states [\textcolor{stringliteral}{"base"}];
459 
460             \textcolor{comment}{// Make all states aware of their names}
461             \textcolor{keywordflow}{foreach} (KeyValuePair<string, LexerState> entry \textcolor{keywordflow}{in} states) \{
462                 entry.Value.name = entry.Key;
463             \}
464         \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{a00117_a646081a52b241abaafe5e0cfaeafd751_icgraph}
\end{center}
\end{figure}


\hypertarget{a00117_ad3ef08f822b310d9864774b057b96995}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!Enter\-State@{Enter\-State}}
\index{Enter\-State@{Enter\-State}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{Enter\-State}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Lexer.\-Enter\-State (
\begin{DoxyParamCaption}
\item[{{\bf Lexer\-State}}]{state}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_ad3ef08f822b310d9864774b057b96995}


Definition at line 672 of file Lexer.\-cs.



References Yarn.\-Lexer.\-current\-State, Yarn.\-Lexer.\-Lexer\-State.\-set\-Track\-Next\-Indentation, and Yarn.\-Lexer.\-should\-Track\-Next\-Indentation.



Referenced by Yarn.\-Lexer.\-Tokenise\-Line().


\begin{DoxyCode}
672                                           \{
673             \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState} = state;
674 
675             \textcolor{keywordflow}{if} (\hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState}.\hyperlink{a00118_ad8b6ccac53bedd9dc202ffe6ac5698b2}{setTrackNextIndentation})
676                 \hyperlink{a00117_ac670aac2245cbd4694dfbd5b69313218}{shouldTrackNextIndentation} = \textcolor{keyword}{true};
677         \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00117_ad3ef08f822b310d9864774b057b96995_icgraph}
\end{center}
\end{figure}


\hypertarget{a00117_a4079b10b099e5d85f5482f9e7eac4179}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!Line\-Indentation@{Line\-Indentation}}
\index{Line\-Indentation@{Line\-Indentation}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{Line\-Indentation}]{\setlength{\rightskip}{0pt plus 5cm}int Yarn.\-Lexer.\-Line\-Indentation (
\begin{DoxyParamCaption}
\item[{string}]{line}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_a4079b10b099e5d85f5482f9e7eac4179}


Definition at line 660 of file Lexer.\-cs.



Referenced by Yarn.\-Lexer.\-Tokenise\-Line().


\begin{DoxyCode}
661         \{
662             var initialIndentRegex = \textcolor{keyword}{new} Regex (\textcolor{stringliteral}{@"^(\(\backslash\)s*)"});
663             var match = initialIndentRegex.Match (line);
664 
665             \textcolor{keywordflow}{if} (match == null || match.Groups [0] == null) \{
666                 \textcolor{keywordflow}{return} 0;
667             \}
668 
669             \textcolor{keywordflow}{return} match.Groups [0].Length;
670         \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00117_a4079b10b099e5d85f5482f9e7eac4179_icgraph}
\end{center}
\end{figure}


\hypertarget{a00117_a6a09f1bb13f28acd95fd081954b45437}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!Tokenise@{Tokenise}}
\index{Tokenise@{Tokenise}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{Tokenise}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Token\-List} Yarn.\-Lexer.\-Tokenise (
\begin{DoxyParamCaption}
\item[{string}]{title, }
\item[{string}]{text}
\end{DoxyParamCaption}
)}}\label{a00117_a6a09f1bb13f28acd95fd081954b45437}


Definition at line 466 of file Lexer.\-cs.



References Yarn.\-Lexer.\-current\-State, Yarn.\-Lexer.\-default\-State, Yarn.\-Lexer.\-indentation\-Stack, and Yarn.\-Lexer.\-should\-Track\-Next\-Indentation.


\begin{DoxyCode}
467         \{
468 
469             \textcolor{comment}{// Do some initial setup}
470             \hyperlink{a00117_a6631a1b1a9109258ab18927e7587ff9b}{indentationStack} = \textcolor{keyword}{new} Stack<KeyValuePair<int,bool>> ();
471             indentationStack.Push (\textcolor{keyword}{new} KeyValuePair<int, bool>(0, \textcolor{keyword}{false}));
472             \hyperlink{a00117_ac670aac2245cbd4694dfbd5b69313218}{shouldTrackNextIndentation} = \textcolor{keyword}{false};
473 
474             var tokens = \textcolor{keyword}{new} TokenList();
475 
476             \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState} = \hyperlink{a00117_a16b5dbf27a377cde5e8ba0eaa05b5710}{defaultState};
477 
478             \textcolor{comment}{// Parse each line}
479             var lines = \textcolor{keyword}{new} List<string>(text.Split (\textcolor{charliteral}{'\(\backslash\)n'}));
480             \textcolor{comment}{// Add a blank line to ensure that we end with zero indentation}
481             lines.Add(\textcolor{stringliteral}{""});
482 
483             \textcolor{keywordtype}{int} lineNumber = 1;
484 
485             \textcolor{keywordflow}{foreach} (var line \textcolor{keywordflow}{in} lines) \{
486                 tokens.AddRange (this.TokeniseLine (line, lineNumber));
487                 lineNumber++;
488             \}
489 
490             var endOfInput = \textcolor{keyword}{new} Token (\hyperlink{a00041_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.EndOfInput, 
      \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState}, lineNumber, 0);
491             tokens.Add (endOfInput);
492 
493             \textcolor{keywordflow}{return} tokens;
494         \}
\end{DoxyCode}
\hypertarget{a00117_a20b63f6ef434f6a40fd388f262f03fa8}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!Tokenise\-Line@{Tokenise\-Line}}
\index{Tokenise\-Line@{Tokenise\-Line}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{Tokenise\-Line}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Token\-List} Yarn.\-Lexer.\-Tokenise\-Line (
\begin{DoxyParamCaption}
\item[{string}]{line, }
\item[{int}]{line\-Number}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_a20b63f6ef434f6a40fd388f262f03fa8}


Definition at line 496 of file Lexer.\-cs.



References Yarn.\-Lexer.\-current\-State, Yarn.\-Lexer.\-Enter\-State(), Yarn.\-Lexer.\-indentation\-Stack, Yarn.\-Lexer.\-L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T, Yarn.\-Lexer.\-Line\-Indentation(), preprocessor.\-previous\-Indentation, Yarn.\-Lexer.\-should\-Track\-Next\-Indentation, Yarn.\-Lexer.\-states, preprocessor.\-this\-Indentation, Yarn.\-Lexer.\-Lexer\-State.\-token\-Rules, and preprocessor.\-top\-Level.


\begin{DoxyCode}
497         \{
498             var lineTokens = \textcolor{keyword}{new} Stack<Token> ();
499 
500             \textcolor{comment}{// Replace tabs with four spaces}
501             line = line.Replace (\textcolor{stringliteral}{"\(\backslash\)t"}, \textcolor{stringliteral}{"    "});
502 
503             \textcolor{comment}{// Strip out \(\backslash\)r's}
504             line = line.Replace(\textcolor{stringliteral}{"\(\backslash\)r"}, \textcolor{stringliteral}{""});
505 
506             \textcolor{comment}{// Record the indentation level if the previous state wants us to}
507 
508             var \hyperlink{a00330_a0e59365a4aa5811f6495b92a51e23573}{thisIndentation} = \hyperlink{a00117_a4079b10b099e5d85f5482f9e7eac4179}{LineIndentation} (line);
509             var \hyperlink{a00330_ade44b858578c3eab7b6f90030a0e3ea1}{previousIndentation} = indentationStack.Peek ();
510 
511             \textcolor{keywordflow}{if} (\hyperlink{a00117_ac670aac2245cbd4694dfbd5b69313218}{shouldTrackNextIndentation} && thisIndentation > 
      previousIndentation.Key) \{
512                 \textcolor{comment}{// If we are more indented than before, emit an}
513                 \textcolor{comment}{// indent token and record this new indent level}
514                 indentationStack.Push (\textcolor{keyword}{new} KeyValuePair<int, bool>(
      \hyperlink{a00330_a0e59365a4aa5811f6495b92a51e23573}{thisIndentation}, \textcolor{keyword}{true}));
515 
516                 var indent = \textcolor{keyword}{new} Token (\hyperlink{a00041_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Indent, \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState}, lineNumber, 
      previousIndentation.Key);
517                 indent.value = \textcolor{stringliteral}{""}.PadLeft (thisIndentation - previousIndentation.Key);
518 
519                 \hyperlink{a00117_ac670aac2245cbd4694dfbd5b69313218}{shouldTrackNextIndentation} = \textcolor{keyword}{false};
520 
521                 lineTokens.Push (indent);
522 
523             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (thisIndentation < previousIndentation.Key) \{
524 
525                 \textcolor{comment}{// If we are less indented, emit a dedent for every}
526                 \textcolor{comment}{// indentation level that we passed on the way back to 0 that also}
527                 \textcolor{comment}{// emitted an indentation token.}
528                 \textcolor{comment}{// at the same time, remove those indent levels from the stack}
529 
530                 \textcolor{keywordflow}{while} (thisIndentation < \hyperlink{a00117_a6631a1b1a9109258ab18927e7587ff9b}{indentationStack}.Peek ().Key) \{
531 
532                     var \hyperlink{a00330_a8b7e5c0b2c6870eaa8f9454b4f33678b}{topLevel} = indentationStack.Pop ();
533 
534                     \textcolor{keywordflow}{if} (topLevel.Value) \{
535                         var dedent = \textcolor{keyword}{new} Token (\hyperlink{a00041_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Dedent, 
      \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState}, lineNumber, 0);
536                         lineTokens.Push (dedent);
537                     \}
538 
539                 \}
540             \}
541 
542             \textcolor{comment}{// Now that we're past any initial indentation, start}
543             \textcolor{comment}{// finding tokens.}
544             \textcolor{keywordtype}{int} columnNumber = \hyperlink{a00330_a0e59365a4aa5811f6495b92a51e23573}{thisIndentation};
545 
546             var whitespace = \textcolor{keyword}{new} Regex (\textcolor{stringliteral}{@"\(\backslash\)s*"});
547 
548             \textcolor{keywordflow}{while} (columnNumber < line.Length) \{
549 
550                 \textcolor{comment}{// If we're about to hit a line comment, abort processing line}
551                 \textcolor{comment}{// immediately}
552                 \textcolor{keywordflow}{if} (line.Substring(columnNumber).StartsWith(\hyperlink{a00117_a29c457125cc4876f8571f5d9afa372e2}{LINE\_COMMENT})) \{
553                     \textcolor{keywordflow}{break};
554                 \}
555 
556                 var matched = \textcolor{keyword}{false};
557 
558                 \textcolor{keywordflow}{foreach} (var rule \textcolor{keywordflow}{in} \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState}.\hyperlink{a00118_adf6563b1dc6f3ef80ed13c2b15b7be03}{tokenRules}) \{
559 
560                     var match = rule.regex.Match (line, columnNumber);
561 
562                     \textcolor{keywordflow}{if} (match.Success == \textcolor{keyword}{false} || match.Length == 0)
563                         \textcolor{keywordflow}{continue};
564 
565                     \textcolor{keywordtype}{string} tokenText;
566 
567                     \textcolor{keywordflow}{if} (rule.type == \hyperlink{a00041_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Text) \{
568                         \textcolor{comment}{// if this is text, then back up to the most recent text}
569                         \textcolor{comment}{// delimiting token, and treat everything from there as}
570                         \textcolor{comment}{// the text.}
571                         \textcolor{comment}{// we do this because we don't want this:}
572                         \textcolor{comment}{//    <<flip Harley3 +1>>}
573                         \textcolor{comment}{// to get matched as this:}
574                         \textcolor{comment}{//    BeginCommand Identifier("flip") Text("Harley3 +1") EndCommand}
575                         \textcolor{comment}{// instead, we want to match it as this:}
576                         \textcolor{comment}{//    BeginCommand Text("flip Harley3 +1") EndCommand}
577 
578                         \textcolor{keywordtype}{int} textStartIndex = \hyperlink{a00330_a0e59365a4aa5811f6495b92a51e23573}{thisIndentation};
579 
580                         \textcolor{keywordflow}{if} (lineTokens.Count > 0) \{
581                             \textcolor{keywordflow}{while} (lineTokens.Peek().type == TokenType.Identifier) \{
582                                 lineTokens.Pop ();
583                             \}
584 
585                             var startDelimiterToken = lineTokens.Peek ();
586                             textStartIndex = startDelimiterToken.columnNumber;
587                             \textcolor{keywordflow}{if} (startDelimiterToken.type == \hyperlink{a00041_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Indent)
588                                 textStartIndex += startDelimiterToken.value.Length;
589                             \textcolor{keywordflow}{if} (startDelimiterToken.type == \hyperlink{a00041_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Dedent)
590                                 textStartIndex = \hyperlink{a00330_a0e59365a4aa5811f6495b92a51e23573}{thisIndentation};
591                         \}
592 
593                         columnNumber = textStartIndex;
594 
595                         var textEndIndex = match.Index + match.Length;
596 
597                         tokenText = line.Substring (textStartIndex, textEndIndex-textStartIndex);
598 
599                     \} \textcolor{keywordflow}{else} \{
600                         tokenText = match.Value;
601                     \}
602 
603                     columnNumber += tokenText.Length;
604 
605                     \textcolor{comment}{// If this was a string, lop off the quotes at the start and}
606                     \textcolor{comment}{// end, and un-escape the quotes and slashes}
607                     \textcolor{keywordflow}{if} (rule.type == \hyperlink{a00041_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.String) \{
608                         tokenText = tokenText.Substring (1, tokenText.Length - 2);
609 
610                         tokenText = tokenText.Replace (\textcolor{stringliteral}{@"\(\backslash\)\(\backslash\)"}, \textcolor{stringliteral}{@"\(\backslash\)"});
611                         tokenText = tokenText.Replace (\textcolor{stringliteral}{@"\(\backslash\)"""}, \textcolor{stringliteral}{@""""});
612                     \}
613 
614                     var token = \textcolor{keyword}{new} Token (rule.type, \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState}, lineNumber, columnNumber, 
      tokenText);
615 
616                     token.delimitsText = rule.delimitsText;
617 
618                     lineTokens.Push (token);
619 
620                     \textcolor{keywordflow}{if} (rule.entersState != null) \{
621                         \textcolor{keywordflow}{if} (\hyperlink{a00117_a2c65c0ba90f973e459583badefef216a}{states}.ContainsKey(rule.entersState) == \textcolor{keyword}{false}) \{
622                             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} TokeniserException (lineNumber, columnNumber, \textcolor{stringliteral}{"Unknown tokeniser
       state "} + rule.entersState);
623                         \}
624 
625                         \hyperlink{a00117_ad3ef08f822b310d9864774b057b96995}{EnterState} (\hyperlink{a00117_a2c65c0ba90f973e459583badefef216a}{states} [rule.entersState]);
626 
627                         \textcolor{keywordflow}{if} (\hyperlink{a00117_ac670aac2245cbd4694dfbd5b69313218}{shouldTrackNextIndentation} == \textcolor{keyword}{true}) \{
628                             \textcolor{keywordflow}{if} (\hyperlink{a00117_a6631a1b1a9109258ab18927e7587ff9b}{indentationStack}.Peek().Key < 
      \hyperlink{a00330_a0e59365a4aa5811f6495b92a51e23573}{thisIndentation}) \{
629                                 indentationStack.Push (\textcolor{keyword}{new} KeyValuePair<int, bool>(
      \hyperlink{a00330_a0e59365a4aa5811f6495b92a51e23573}{thisIndentation}, \textcolor{keyword}{false}));
630                             \}
631 
632                         \}
633                     \}
634 
635                     matched = \textcolor{keyword}{true};
636 
637                     \textcolor{keywordflow}{break};
638                 \}
639 
640                 \textcolor{keywordflow}{if} (matched == \textcolor{keyword}{false}) \{
641 
642                     \textcolor{keywordflow}{throw} TokeniserException.ExpectedTokensFromState (lineNumber, columnNumber, 
      \hyperlink{a00117_ac90b7dce8103425a148f9e8588f14137}{currentState});
643                 \}
644 
645                 \textcolor{comment}{// consume any lingering whitespace before the next token}
646                 var lastWhitespace = whitespace.Match(line, columnNumber);
647                 \textcolor{keywordflow}{if} (lastWhitespace != null) \{
648                     columnNumber += lastWhitespace.Length;
649                 \}
650 
651             \}
652 
653             var listToReturn = \textcolor{keyword}{new} TokenList (lineTokens.ToArray ());
654             listToReturn.Reverse ();
655 
656             \textcolor{keywordflow}{return} listToReturn;
657 
658         \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{a00117_a20b63f6ef434f6a40fd388f262f03fa8_cgraph}
\end{center}
\end{figure}




\subsection{Member Data Documentation}
\hypertarget{a00117_ac90b7dce8103425a148f9e8588f14137}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!current\-State@{current\-State}}
\index{current\-State@{current\-State}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{current\-State}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Lexer\-State} Yarn.\-Lexer.\-current\-State\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_ac90b7dce8103425a148f9e8588f14137}


Definition at line 309 of file Lexer.\-cs.



Referenced by Yarn.\-Lexer.\-Enter\-State(), Yarn.\-Lexer.\-Tokenise(), and Yarn.\-Lexer.\-Tokenise\-Line().

\hypertarget{a00117_a16b5dbf27a377cde5e8ba0eaa05b5710}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!default\-State@{default\-State}}
\index{default\-State@{default\-State}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{default\-State}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Lexer\-State} Yarn.\-Lexer.\-default\-State\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_a16b5dbf27a377cde5e8ba0eaa05b5710}


Definition at line 308 of file Lexer.\-cs.



Referenced by Yarn.\-Lexer.\-Create\-States(), and Yarn.\-Lexer.\-Tokenise().

\hypertarget{a00117_a6631a1b1a9109258ab18927e7587ff9b}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!indentation\-Stack@{indentation\-Stack}}
\index{indentation\-Stack@{indentation\-Stack}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{indentation\-Stack}]{\setlength{\rightskip}{0pt plus 5cm}Stack$<$Key\-Value\-Pair$<$int,bool$>$ $>$ Yarn.\-Lexer.\-indentation\-Stack\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_a6631a1b1a9109258ab18927e7587ff9b}


Definition at line 313 of file Lexer.\-cs.



Referenced by Yarn.\-Lexer.\-Tokenise(), and Yarn.\-Lexer.\-Tokenise\-Line().

\hypertarget{a00117_a29c457125cc4876f8571f5d9afa372e2}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T@{L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T}}
\index{L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T@{L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T}]{\setlength{\rightskip}{0pt plus 5cm}const string Yarn.\-Lexer.\-L\-I\-N\-E\-\_\-\-C\-O\-M\-M\-E\-N\-T = \char`\"{}//\char`\"{}\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_a29c457125cc4876f8571f5d9afa372e2}


Definition at line 304 of file Lexer.\-cs.



Referenced by Yarn.\-Lexer.\-Tokenise\-Line().

\hypertarget{a00117_ac670aac2245cbd4694dfbd5b69313218}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!should\-Track\-Next\-Indentation@{should\-Track\-Next\-Indentation}}
\index{should\-Track\-Next\-Indentation@{should\-Track\-Next\-Indentation}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{should\-Track\-Next\-Indentation}]{\setlength{\rightskip}{0pt plus 5cm}bool Yarn.\-Lexer.\-should\-Track\-Next\-Indentation\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_ac670aac2245cbd4694dfbd5b69313218}


Definition at line 314 of file Lexer.\-cs.



Referenced by Yarn.\-Lexer.\-Enter\-State(), Yarn.\-Lexer.\-Tokenise(), and Yarn.\-Lexer.\-Tokenise\-Line().

\hypertarget{a00117_a2c65c0ba90f973e459583badefef216a}{\index{Yarn\-::\-Lexer@{Yarn\-::\-Lexer}!states@{states}}
\index{states@{states}!Yarn::Lexer@{Yarn\-::\-Lexer}}
\subsubsection[{states}]{\setlength{\rightskip}{0pt plus 5cm}Dictionary$<$string, {\bf Lexer\-State}$>$ Yarn.\-Lexer.\-states\hspace{0.3cm}{\ttfamily [private]}}}\label{a00117_a2c65c0ba90f973e459583badefef216a}


Definition at line 306 of file Lexer.\-cs.



Referenced by Yarn.\-Lexer.\-Create\-States(), and Yarn.\-Lexer.\-Tokenise\-Line().



The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
Yarn\-Spinner/\hyperlink{a00292}{Lexer.\-cs}\end{DoxyCompactItemize}
