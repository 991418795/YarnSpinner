\hypertarget{a00029}{\section{Yarn.\-Compiler Class Reference}
\label{a00029}\index{Yarn.\-Compiler@{Yarn.\-Compiler}}
}


Collaboration diagram for Yarn.\-Compiler\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=224pt]{d3/db1/a00200}
\end{center}
\end{figure}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{a00029_de/d38/a00160}{Compile\-Flags}
\end{DoxyCompactItemize}
\subsection*{Package Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{a00029_a47bfde319a618a1e11d00cb282a84364}{Compiler} (string program\-Name)
\item 
void \hyperlink{a00029_a10b52c5694f78285d087a455e3654eaa}{Compile\-Node} (\hyperlink{a00054}{Parser.\-Node} node)
\end{DoxyCompactItemize}
\subsection*{Properties}
\begin{DoxyCompactItemize}
\item 
\hyperlink{a00067}{Program} \hyperlink{a00029_aa1737da428ec7d597009661dd8a47829}{program}\hspace{0.3cm}{\ttfamily  \mbox{[}get, set\mbox{]}}
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
string \hyperlink{a00029_a1bae0d8b701a59708641aa36ea971fa5}{Register\-Label} (string commentary=null)
\item 
void \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{Byte\-Code} code, object operand\-A=null, object operand\-B=null)
\item 
void \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00076}{Parser.\-Statement} statement)
\item 
void \hyperlink{a00029_a656b6c7fcd08d24300ec592465274f66}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00032}{Parser.\-Custom\-Command} statement)
\item 
void \hyperlink{a00029_a860767f3594afeae1c5fe21b7b82cbc6}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, string line)
\item 
void \hyperlink{a00029_a3e492edcefdfeacec80e528f8c4fa6cc}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00071}{Parser.\-Shortcut\-Option\-Group} statement)
\item 
void \hyperlink{a00029_ab4f6dd2ddf38b0c5bfb2b8a40869a09a}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, I\-Enumerable$<$ \hyperlink{a00076}{Yarn.\-Parser.\-Statement} $>$ statement\-List)
\item 
void \hyperlink{a00029_a6ab14514a3b0644ae39c626e5e5e180d}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00043}{Parser.\-If\-Statement} statement)
\item 
void \hyperlink{a00029_a5cb3cbcd9727bdef018ec5299bd13142}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00061}{Parser.\-Option\-Statement} statement)
\item 
void \hyperlink{a00029_afb86d9228f66896abe31d47d72a267ce}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00019}{Parser.\-Assignment\-Statement} statement)
\item 
void \hyperlink{a00029_a5c762915320958c3a03b193b06a7e279}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00040}{Parser.\-Expression} expression)
\item 
void \hyperlink{a00029_a41438a0b25f2668a180372d05127d891}{Generate\-Code} (\hyperlink{a00026_dd/dae/a00163}{Node} node, \hyperlink{a00087}{Parser.\-Value\-Node} value)
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{a00029_de/d38/a00160}{Compile\-Flags} \hyperlink{a00029_a541022d89bcf9bc8f794eb6d6b438d08}{flags}
\item 
int \hyperlink{a00029_a87758397eba2e84cda8e0d6c40656f3f}{label\-Count} = 0
\end{DoxyCompactItemize}


\subsection{Detailed Description}


\subsection{Class Documentation}
\index{Yarn\-::\-Compiler\-::\-Compile\-Flags@{Yarn\-::\-Compiler\-::\-Compile\-Flags}}\label{de/d38/a00160}
\hypertarget{a00029_de/d38/a00160}{}
\subsubsection{struct Yarn\-:\-:Compiler\-:\-:Compile\-Flags}


Collaboration diagram for Yarn.\-Compiler.\-Compile\-Flags\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=224pt]{d6/dfb/a00172}
\end{center}
\end{figure}
\begin{DoxyFields}{Class Members}
\hypertarget{a00029_a8b49bb7763ff477cba21d7c771ef3ed0}{bool}\label{a00029_a8b49bb7763ff477cba21d7c771ef3ed0}
&
Disable\-Shuffle\-Options\-After\-Next\-Set&
\\
\hline

\end{DoxyFields}


\subsection{Constructor \& Destructor Documentation}
\hypertarget{a00029_a47bfde319a618a1e11d00cb282a84364}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Compiler@{Compiler}}
\index{Compiler@{Compiler}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Compiler}]{\setlength{\rightskip}{0pt plus 5cm}Yarn.\-Compiler.\-Compiler (
\begin{DoxyParamCaption}
\item[{string}]{program\-Name}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [package]}}}\label{a00029_a47bfde319a618a1e11d00cb282a84364}

\begin{DoxyCode}
254         \{
255             \hyperlink{a00029_aa1737da428ec7d597009661dd8a47829}{program} = \textcolor{keyword}{new} Program ();
256         \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{a00029_a10b52c5694f78285d087a455e3654eaa}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Compile\-Node@{Compile\-Node}}
\index{Compile\-Node@{Compile\-Node}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Compile\-Node}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Compile\-Node (
\begin{DoxyParamCaption}
\item[{{\bf Parser.\-Node}}]{node}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [package]}}}\label{a00029_a10b52c5694f78285d087a455e3654eaa}

\begin{DoxyCode}
258                                                     \{
259 
260             \textcolor{keywordflow}{if} (\hyperlink{a00029_aa1737da428ec7d597009661dd8a47829}{program}.\hyperlink{a00067_a3f4928a577c88263ad016be259b175c4}{nodes}.ContainsKey(node.name)) \{
261                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentException (\textcolor{stringliteral}{"Duplicate node name "} + node.name);
262             \}
263 
264             var compiledNode =  \textcolor{keyword}{new} Node();
265 
266             compiledNode.name = node.name;
267 
268             var startLabel = \hyperlink{a00029_a1bae0d8b701a59708641aa36ea971fa5}{RegisterLabel} ();
269             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (compiledNode, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label, startLabel);
270 
271             \textcolor{keywordflow}{foreach} (var statement \textcolor{keywordflow}{in} node.statements) \{
272                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (compiledNode, statement);
273             \}
274 
275             \textcolor{comment}{// Does this node end after emitting AddOptions codes}
276             \textcolor{comment}{// without calling ShowOptions?}
277 
278             \textcolor{comment}{// Note: this only works when we know that we don't have}
279             \textcolor{comment}{// AddOptions and then Jump up back into the code to run them.}
280             \textcolor{comment}{// TODO: A better solution would be for the parser to flag}
281             \textcolor{comment}{// whether a node has Options at the end.}
282             var hasRemainingOptions = \textcolor{keyword}{false};
283             \textcolor{keywordflow}{foreach} (var instruction \textcolor{keywordflow}{in} compiledNode.instructions) \{
284                 \textcolor{keywordflow}{if} (instruction.operation == \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.AddOption) \{
285                     hasRemainingOptions = \textcolor{keyword}{true};
286                 \}
287                 \textcolor{keywordflow}{if} (instruction.operation == \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.ShowOptions) \{
288                     hasRemainingOptions = \textcolor{keyword}{false};
289                 \}
290             \}
291 
292             \textcolor{comment}{// If this compiled node has no lingering options to show at the end of the node, then stop at
       the end}
293             \textcolor{keywordflow}{if} (hasRemainingOptions == \textcolor{keyword}{false}) \{
294                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (compiledNode, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Stop);
295             \} \textcolor{keywordflow}{else} \{
296                 \textcolor{comment}{// Otherwise, show the accumulated nodes and then jump to the selected node}
297 
298                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (compiledNode, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.ShowOptions);
299 
300                 \textcolor{keywordflow}{if} (\hyperlink{a00029_a541022d89bcf9bc8f794eb6d6b438d08}{flags}.\hyperlink{a00029_a8b49bb7763ff477cba21d7c771ef3ed0}{DisableShuffleOptionsAfterNextSet} == \textcolor{keyword}{true}) 
      \{
301                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (compiledNode, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushBool, \textcolor{keyword}{false});
302                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (compiledNode, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.StoreVariable, VirtualMachine.SpecialVariables
      .ShuffleOptions);
303                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (compiledNode, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Pop);
304                     flags.DisableShuffleOptionsAfterNextSet = \textcolor{keyword}{false};
305                 \}
306 
307                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (compiledNode, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.RunNode);
308             \}
309 
310             \textcolor{keywordflow}{if} (node.source != null) \{
311                 compiledNode.sourceTextStringID = program.RegisterString (node.source, node.name);
312             \}
313 
314             program.nodes [compiledNode.name] = compiledNode;
315         \}
\end{DoxyCode}
\hypertarget{a00029_a774e8c143cdda0584fcfdda98626a83c}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Emit@{Emit}}
\index{Emit@{Emit}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Emit}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Emit (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Byte\-Code}}]{code, }
\item[{object}]{operand\-A = {\ttfamily null}, }
\item[{object}]{operand\-B = {\ttfamily null}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a774e8c143cdda0584fcfdda98626a83c}

\begin{DoxyCode}
324                                                                                             \{
325             var instruction = \textcolor{keyword}{new} Instruction();
326             instruction.operation = code;
327             instruction.operandA = operandA;
328             instruction.operandB = operandB;
329 
330             node.instructions.Add (instruction);
331 
332             \textcolor{keywordflow}{if} (code == \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label) \{
333                 \textcolor{comment}{// Add this label to the label table}
334                 node.labels.Add ((string)instruction.operandA, node.instructions.Count - 1);
335             \}
336         \}
\end{DoxyCode}
\hypertarget{a00029_a006f3becd521cc179ba3d3352f6f930b}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-Statement}}]{statement}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a006f3becd521cc179ba3d3352f6f930b}

\begin{DoxyCode}
339                                                                  \{
340             \textcolor{keywordflow}{switch} (statement.type) \{
341             \textcolor{keywordflow}{case} Parser.Statement.Type.CustomCommand:
342                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.customCommand);
343                 \textcolor{keywordflow}{break};
344             \textcolor{keywordflow}{case} Parser.Statement.Type.ShortcutOptionGroup:
345                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.shortcutOptionGroup);
346                 \textcolor{keywordflow}{break};
347             \textcolor{keywordflow}{case} Parser.Statement.Type.Block:
348                 
349                 \textcolor{comment}{// Blocks are just groups of statements}
350                 \textcolor{keywordflow}{foreach} (var blockStatement \textcolor{keywordflow}{in} statement.block.statements) \{
351                     \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode}(node, blockStatement);
352                 \}
353 
354                 \textcolor{keywordflow}{break};
355 
356 
357             \textcolor{keywordflow}{case} Parser.Statement.Type.IfStatement:
358                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.ifStatement);
359                 \textcolor{keywordflow}{break};
360 
361             \textcolor{keywordflow}{case} Parser.Statement.Type.OptionStatement:
362                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.optionStatement);
363                 \textcolor{keywordflow}{break};
364 
365             \textcolor{keywordflow}{case} Parser.Statement.Type.AssignmentStatement:
366                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.assignmentStatement);
367                 \textcolor{keywordflow}{break};
368 
369             \textcolor{keywordflow}{case} Parser.Statement.Type.Line:
370                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.line);
371                 \textcolor{keywordflow}{break};
372 
373             \textcolor{keywordflow}{default}:
374                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException ();
375             \}
376 
377 
378         \}
\end{DoxyCode}
\hypertarget{a00029_a656b6c7fcd08d24300ec592465274f66}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-Custom\-Command}}]{statement}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a656b6c7fcd08d24300ec592465274f66}

\begin{DoxyCode}
380                                                                      \{
381 
382             \textcolor{comment}{// If this command is an evaluable expression, evaluate it}
383             \textcolor{keywordflow}{if} (statement.expression != null) \{
384                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.expression);
385             \} \textcolor{keywordflow}{else} \{
386                 \textcolor{keywordflow}{switch} (statement.clientCommand) \{
387                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{"stop"}:
388                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Stop);
389                     \textcolor{keywordflow}{break};
390                 \textcolor{keywordflow}{case} \textcolor{stringliteral}{"shuffleNextOptions"}:
391                     \textcolor{comment}{// Emit code that sets "VAR\_SHUFFLE\_OPTIONS" to true}
392                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushBool, \textcolor{keyword}{true});
393                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.StoreVariable, VirtualMachine.SpecialVariables.
      ShuffleOptions);
394                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Pop);
395                     flags.DisableShuffleOptionsAfterNextSet = \textcolor{keyword}{true};
396                     \textcolor{keywordflow}{break};
397 
398                 \textcolor{keywordflow}{default}:
399                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.RunCommand, statement.clientCommand);
400                     \textcolor{keywordflow}{break};
401                 \}
402             \}
403 
404         \}
\end{DoxyCode}
\hypertarget{a00029_a860767f3594afeae1c5fe21b7b82cbc6}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{string}]{line}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a860767f3594afeae1c5fe21b7b82cbc6}

\begin{DoxyCode}
406                                                   \{
407             var num = program.RegisterString (line, node.name);
408 
409             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.RunLine, num);
410 
411         \}
\end{DoxyCode}
\hypertarget{a00029_a3e492edcefdfeacec80e528f8c4fa6cc}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-Shortcut\-Option\-Group}}]{statement}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a3e492edcefdfeacec80e528f8c4fa6cc}

\begin{DoxyCode}
413                                                                            \{
414 
415             var endOfGroupLabel = \hyperlink{a00029_a1bae0d8b701a59708641aa36ea971fa5}{RegisterLabel} (\textcolor{stringliteral}{"group\_end"});
416 
417             var labels = \textcolor{keyword}{new} List<string> ();
418 
419             \textcolor{keywordtype}{int} optionCount = 0;
420             \textcolor{keywordflow}{foreach} (var shortcutOption \textcolor{keywordflow}{in} statement.options) \{
421 
422                 var optionDestinationLabel = \hyperlink{a00029_a1bae0d8b701a59708641aa36ea971fa5}{RegisterLabel} (\textcolor{stringliteral}{"option\_"} + (optionCount+1));
423                 labels.Add (optionDestinationLabel);
424 
425                 \textcolor{keywordtype}{string} endOfClauseLabel = null;
426 
427                 \textcolor{keywordflow}{if} (shortcutOption.condition != null) \{
428                     endOfClauseLabel = \hyperlink{a00029_a1bae0d8b701a59708641aa36ea971fa5}{RegisterLabel} (\textcolor{stringliteral}{"conditional\_"}+optionCount);
429                     \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, shortcutOption.condition);
430 
431                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.JumpIfFalse, endOfClauseLabel);
432                 \}
433 
434                 var labelStringID = program.RegisterString (shortcutOption.label, node.name);
435 
436                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.AddOption, labelStringID, optionDestinationLabel);
437 
438                 \textcolor{keywordflow}{if} (shortcutOption.condition != null) \{
439                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label, endOfClauseLabel);
440                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Pop);
441                 \}
442 
443                 optionCount++;
444             \}
445 
446             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.ShowOptions);
447 
448             \textcolor{keywordflow}{if} (\hyperlink{a00029_a541022d89bcf9bc8f794eb6d6b438d08}{flags}.\hyperlink{a00029_a8b49bb7763ff477cba21d7c771ef3ed0}{DisableShuffleOptionsAfterNextSet} == \textcolor{keyword}{true}) \{
449                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushBool, \textcolor{keyword}{false});
450                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.StoreVariable, VirtualMachine.SpecialVariables.
      ShuffleOptions);
451                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Pop);
452                 flags.DisableShuffleOptionsAfterNextSet = \textcolor{keyword}{false};
453             \}
454 
455             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Jump);
456 
457             optionCount = 0;
458             \textcolor{keywordflow}{foreach} (var shortcutOption \textcolor{keywordflow}{in} statement.options) \{
459 
460                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label, labels [optionCount]);
461 
462                 \textcolor{keywordflow}{if} (shortcutOption.optionNode != null)
463                     \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, shortcutOption.optionNode.statements);
464 
465                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.JumpTo, endOfGroupLabel);
466 
467                 optionCount++;
468 
469             \}
470 
471             \textcolor{comment}{// reached the end of the option group}
472             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label, endOfGroupLabel);
473 
474             \textcolor{comment}{// clean up after the jump}
475             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Pop);
476 
477 
478         \}
\end{DoxyCode}
\hypertarget{a00029_ab4f6dd2ddf38b0c5bfb2b8a40869a09a}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{I\-Enumerable$<$ {\bf Yarn.\-Parser.\-Statement} $>$}]{statement\-List}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_ab4f6dd2ddf38b0c5bfb2b8a40869a09a}

\begin{DoxyCode}
480                                                                                        \{
481 
482             \textcolor{keywordflow}{if} (statementList == null)
483                 \textcolor{keywordflow}{return};
484 
485             \textcolor{keywordflow}{foreach} (var statement \textcolor{keywordflow}{in} statementList) \{
486                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement);
487             \}
488         \}
\end{DoxyCode}
\hypertarget{a00029_a6ab14514a3b0644ae39c626e5e5e180d}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-If\-Statement}}]{statement}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a6ab14514a3b0644ae39c626e5e5e180d}

\begin{DoxyCode}
490                                                                    \{
491 
492             \textcolor{comment}{// We'll jump to this label at the end of every clause}
493             var endOfIfStatementLabel = \hyperlink{a00029_a1bae0d8b701a59708641aa36ea971fa5}{RegisterLabel} (\textcolor{stringliteral}{"endif"});
494 
495             \textcolor{keywordflow}{foreach} (var clause \textcolor{keywordflow}{in} statement.clauses) \{
496                 var endOfClauseLabel = \hyperlink{a00029_a1bae0d8b701a59708641aa36ea971fa5}{RegisterLabel} (\textcolor{stringliteral}{"skipclause"});
497 
498                 \textcolor{keywordflow}{if} (clause.expression != null) \{
499                     
500                     \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, clause.expression);
501 
502                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.JumpIfFalse, endOfClauseLabel);
503 
504                 \}
505 
506                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, clause.statements);
507 
508                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.JumpTo, endOfIfStatementLabel);
509 
510                 \textcolor{keywordflow}{if} (clause.expression != null) \{
511                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label, endOfClauseLabel);
512                 \}
513                 \textcolor{comment}{// Clean up the stack by popping the expression that was tested earlier}
514                 \textcolor{keywordflow}{if} (clause.expression != null) \{
515                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Pop);
516                 \}
517             \}
518 
519             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Label, endOfIfStatementLabel);
520         \}
\end{DoxyCode}
\hypertarget{a00029_a5cb3cbcd9727bdef018ec5299bd13142}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-Option\-Statement}}]{statement}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a5cb3cbcd9727bdef018ec5299bd13142}

\begin{DoxyCode}
522                                                                        \{
523 
524             var destination = statement.destination;
525 
526             \textcolor{keywordflow}{if} (statement.label == null) \{
527                 \textcolor{comment}{// this is a jump to another node}
528                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit}(node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.RunNode, destination); 
529             \} \textcolor{keywordflow}{else} \{
530                 var stringID = program.RegisterString (statement.label, node.name);
531 
532                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.AddOption, stringID, destination);
533             \}
534 
535         \}
\end{DoxyCode}
\hypertarget{a00029_afb86d9228f66896abe31d47d72a267ce}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-Assignment\-Statement}}]{statement}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_afb86d9228f66896abe31d47d72a267ce}

\begin{DoxyCode}
537                                                                            \{
538 
539             \textcolor{comment}{// Is it a straight assignment?}
540             \textcolor{keywordflow}{if} (statement.operation == \hyperlink{a00026_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.EqualToOrAssign) \{
541                 \textcolor{comment}{// Evaluate the expression, which will result in a value}
542                 \textcolor{comment}{// on the stack}
543                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.valueExpression);
544 
545                 \textcolor{comment}{// Stack now contains [destinationValue]}
546             \} \textcolor{keywordflow}{else} \{
547 
548                 \textcolor{comment}{// It's a combined operation-plus-assignment}
549 
550                 \textcolor{comment}{// Get the current value of the variable}
551                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit}(node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushVariable, statement.destinationVariableName);
552 
553                 \textcolor{comment}{// Evaluate the expression, which will result in a value}
554                 \textcolor{comment}{// on the stack}
555                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, statement.valueExpression);
556 
557                 \textcolor{comment}{// Stack now contains [currentValue, expressionValue]}
558 
559                 \textcolor{keywordflow}{switch} (statement.operation) \{
560 
561                 \textcolor{keywordflow}{case} TokenType.AddAssign:
562                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.CallFunc, \hyperlink{a00026_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Add.ToString ());
563                     \textcolor{keywordflow}{break};
564                 \textcolor{keywordflow}{case} TokenType.MinusAssign:
565                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.CallFunc, \hyperlink{a00026_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Minus.ToString ());
566                     \textcolor{keywordflow}{break};
567                 \textcolor{keywordflow}{case} TokenType.MultiplyAssign:
568                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.CallFunc, \hyperlink{a00026_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Multiply.ToString ());
569                     \textcolor{keywordflow}{break};
570                 \textcolor{keywordflow}{case} TokenType.DivideAssign:
571                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.CallFunc, \hyperlink{a00026_a301aa7c866593a5b625a8fc158bbeace}{TokenType}.Divide.ToString ());
572                     \textcolor{keywordflow}{break};
573                 \textcolor{keywordflow}{default}:
574                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException ();
575                 \}
576 
577                 \textcolor{comment}{// Stack now contains [destinationValue]}
578             \}
579 
580             \textcolor{comment}{// Store the top of the stack in the variable}
581             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit}(node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.StoreVariable, statement.destinationVariableName);
582 
583             \textcolor{comment}{// Clean up the stack}
584             \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.Pop);
585 
586         \}
\end{DoxyCode}
\hypertarget{a00029_a5c762915320958c3a03b193b06a7e279}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-Expression}}]{expression}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a5c762915320958c3a03b193b06a7e279}

\begin{DoxyCode}
588                                                                    \{
589 
590             \textcolor{comment}{// Expressions are either plain values, or function calls}
591             \textcolor{keywordflow}{switch} (expression.type) \{
592             \textcolor{keywordflow}{case} Parser.Expression.Type.Value:
593                 \textcolor{comment}{// Plain value? Emit that}
594                 \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, expression.value);
595                 \textcolor{keywordflow}{break};
596             \textcolor{keywordflow}{case} Parser.Expression.Type.FunctionCall:
597                 \textcolor{comment}{// Evaluate all parameter expressions (which will}
598                 \textcolor{comment}{// push them to the stack)}
599                 \textcolor{keywordflow}{foreach} (var parameter \textcolor{keywordflow}{in} expression.parameters) \{
600                     \hyperlink{a00029_a006f3becd521cc179ba3d3352f6f930b}{GenerateCode} (node, parameter);
601                 \}
602                 \textcolor{comment}{// If this function has a variable number of parameters, put}
603                 \textcolor{comment}{// the number of parameters that were passed onto the stack}
604                 \textcolor{keywordflow}{if} (expression.function.paramCount == -1) \{
605                     \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushNumber, expression.parameters.Count);
606                 \}
607 
608                 \textcolor{comment}{// And then call the function}
609                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.CallFunc, expression.function.name);
610                 \textcolor{keywordflow}{break};
611             \}
612         \}
\end{DoxyCode}
\hypertarget{a00029_a41438a0b25f2668a180372d05127d891}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Generate\-Code@{Generate\-Code}}
\index{Generate\-Code@{Generate\-Code}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Generate\-Code}]{\setlength{\rightskip}{0pt plus 5cm}void Yarn.\-Compiler.\-Generate\-Code (
\begin{DoxyParamCaption}
\item[{{\bf Node}}]{node, }
\item[{{\bf Parser.\-Value\-Node}}]{value}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a41438a0b25f2668a180372d05127d891}

\begin{DoxyCode}
614                                                              \{
615 
616             \textcolor{comment}{// Push a value onto the stack}
617 
618             \textcolor{keywordflow}{switch} (value.value.type) \{
619             \textcolor{keywordflow}{case} Value.Type.Number:
620                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushNumber, value.value.numberValue);
621                 \textcolor{keywordflow}{break};
622             \textcolor{keywordflow}{case} Value.Type.String:
623                 var \textcolor{keywordtype}{id} = program.RegisterString (value.value.stringValue, node.name);
624                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushString, \textcolor{keywordtype}{id});
625                 \textcolor{keywordflow}{break};
626             \textcolor{keywordflow}{case} Value.Type.Bool:
627                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushBool, value.value.boolValue);
628                 \textcolor{keywordflow}{break};
629             \textcolor{keywordflow}{case} Value.Type.Variable:
630                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushVariable, value.value.variableName);
631                 \textcolor{keywordflow}{break};
632             \textcolor{keywordflow}{case} Value.Type.Null:
633                 \hyperlink{a00029_a774e8c143cdda0584fcfdda98626a83c}{Emit} (node, \hyperlink{a00026_ad5dfb6ee68ca7469623ad3e459f98894}{ByteCode}.PushNull);
634                 \textcolor{keywordflow}{break};
635             \textcolor{keywordflow}{default}:
636                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException ();
637             \}
638         \}
\end{DoxyCode}
\hypertarget{a00029_a1bae0d8b701a59708641aa36ea971fa5}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!Register\-Label@{Register\-Label}}
\index{Register\-Label@{Register\-Label}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{Register\-Label}]{\setlength{\rightskip}{0pt plus 5cm}string Yarn.\-Compiler.\-Register\-Label (
\begin{DoxyParamCaption}
\item[{string}]{commentary = {\ttfamily null}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a1bae0d8b701a59708641aa36ea971fa5}

\begin{DoxyCode}
320                                                        \{
321             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"L"} + \hyperlink{a00029_a87758397eba2e84cda8e0d6c40656f3f}{labelCount}++ + commentary;
322         \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\hypertarget{a00029_a541022d89bcf9bc8f794eb6d6b438d08}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!flags@{flags}}
\index{flags@{flags}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{flags}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Compile\-Flags} Yarn.\-Compiler.\-flags\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a541022d89bcf9bc8f794eb6d6b438d08}
\hypertarget{a00029_a87758397eba2e84cda8e0d6c40656f3f}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!label\-Count@{label\-Count}}
\index{label\-Count@{label\-Count}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{label\-Count}]{\setlength{\rightskip}{0pt plus 5cm}int Yarn.\-Compiler.\-label\-Count = 0\hspace{0.3cm}{\ttfamily [private]}}}\label{a00029_a87758397eba2e84cda8e0d6c40656f3f}


\subsection{Property Documentation}
\hypertarget{a00029_aa1737da428ec7d597009661dd8a47829}{\index{Yarn\-::\-Compiler@{Yarn\-::\-Compiler}!program@{program}}
\index{program@{program}!Yarn::Compiler@{Yarn\-::\-Compiler}}
\subsubsection[{program}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Program} Yarn.\-Compiler.\-program\hspace{0.3cm}{\ttfamily [get]}, {\ttfamily [set]}, {\ttfamily [package]}}}\label{a00029_aa1737da428ec7d597009661dd8a47829}


The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
Yarn\-Spinner/\hyperlink{a00116}{Compiler.\-cs}\end{DoxyCompactItemize}
